

--- Log Analysis with Splunk ---

• Exploring the Logs
• Initial Triage
• Visualizing the Logs Timeline
• Anomaly Detection
• Filtering out Benign Values
• Narrowing Down Suspicious IPs
• Tracing the Attack Chain
• Exfiltration Attempts
• Ransomware Staging & RCE
• Correlate Outbound C2 Communication
• Volume of Data Exfiltrated
• Conclusion


-- Exploring the Logs --

This phase provides an initial overview of all logs available in the Splunk environment. The goal is to identify the available data sources and verify that log ingestion was successful.

Search query: index=main
Timeline: All time 
Sourcetype Field: web_traffic, firewall_logs


-- Initial Triage --

Initial review of the web server logs to identify anomalies, traffic spikes, and key fields relevant for further analysis.

Search query: index=main sourcetype=web_traffic

The timeline reveals a significant traffic spike
Key fields used in the investigation:
• client_ip
• user_agent
• path
• status

➜ Let's break down our result for a better understanding

• Search query: This query retrieves all events from the main index that were tagged with the custom source type web_traffic. This marks the beginning of the investigation.
• Time range: The time range is currently set to "All time". In security analysis, this range would be tightened (e.g., to the spike window) after initial data loading.
• Timeline: This visual histogram shows the distribution of the 17,172 events over time. The graph indicates the successful daily log volume followed by a distinctive traffic spike (a period of high activity, likely the attack window).
• Selected fields: These are the fields currently chosen to be displayed in the summary column of the event list (host, source, sourcetype). They represent basic metadata about the log file itself.
• Interesting fields: This pane lists all fields that Splunk has automatically extracted or manually added. Fields prefixed with # (e.g., #date_hour) are automatically generated by Splunk's time commands. The presence of user_agent, path, and client_ip confirms the successful parsing of the web log structure.
• Event details & field extraction: This section shows the parsed details of a single event with extracted fields like user_agent, path, status, client_ip, and more.


-- Visualizing the Logs Timeline --

Visualization of event volume per day to identify abnormal activity and determine the attack window.

Search query: index=main sourcetype=web_traffic | timechart span=1d count
Search query: index=main sourcetype=web_traffic | timechart span=1d count | sort by count
Search query: index=main sourcetype=web_traffic | timechart span=1d count | sort by count | reverse 

• One specific day shows an unusually high number of events
• This period represents the main attack phase


-- Anomaly Detection --

Inspection of individual fields to identify suspicious or malicious patterns.

• user_agent
• client_ip
• path

➜ Important Additional Information

• Presence of non-browser and automated user agents
• Repeated requests from the same IP address
• Suspicious paths related to configuration files and exploitation attempts


-- Filtering out Benign Values --

Removal of legitimate user traffic to isolate automated and potentially malicious activity.

Search query: index=main sourcetype=web_traffic user_agent!=*Mozilla* user_agent!=*Chrome* user_agent!=*Safari* user_agent!=*Firefox*

➜ Important Additional Information

• Excludes standard browser traffic
• Leaves behind suspicious automated requests
• Enables clear identification of malicious behavior


-- Narrowing Down Suspicious IPs --

Identification of IP addresses responsible for the highest volume of suspicious traffic.

Search query: sourcetype=web_traffic user_agent!=*Mozilla* user_agent!=*Chrome* user_agent!=*Safari* user_agent!=*Firefox* | stats count by client_ip | sort -count | head 5

➜ Important Additional Information

• A single IP address dominates the results
• Attacker IP identified: 198.51.100.55


-- Tracing the Attack Chain --

> Reconnaissance (Footprinting) <

Identification of early probing activity targeting exposed configuration files.

Search query: sourcetype=web_traffic client_ip="198.51.100.55" AND path IN ("/.env", "/*phpinfo*", "/.git*") | table _time, path, user_agent, status

➜ Important Additional Information

• Tools observed: curl, wget
• HTTP status codes: 401, 403, 404
• Confirms the reconnaissance phase

> Enumeration (Vulnerability Testing) <

Detection of active vulnerability testing, such as path traversal and open redirect attempts.

Search query: sourcetype=web_traffic client_ip="198.51.100.55" AND path="*..*" OR path="*redirect*"
Search query: sourcetype=web_traffic client_ip="198.51.100.55" AND path="*..\/..\/*" OR path="*redirect*" | stats count by path

➜ Important Additional Information

• Attempts to access system files
• Marks transition from reconnaissance to exploitation

> SQL Injection Attack <

Identification of automated SQL injection attempts.

Search query: sourcetype=web_traffic client_ip="198.51.100.55" AND user_agent IN ("*sqlmap*", "*Havij*") | table _time, path, status

➜ Important Additional Information

• Time-based payloads (e.g., SLEEP(5))
• HTTP 504 responses indicate successful exploitation


-- Exfiltration Attempts --

Detection of attempts to download large and sensitive files from the server.

Search query: sourcetype=web_traffic client_ip="198.51.100.55" AND path IN ("*backup.zip*", "*logs.tar.gz*") | table _time path, user_agent

➜ Important Additional Information

• Access to compressed backup and log files
• Confirms data theft activity


-- Ransomware Staging & RCE --

Evidence of full system compromise through webshell execution and malware deployment. Requests for sensitive archives like /logs.tar.gz and /config indicate the attacker is gathering data for double-extortion.

Search query: sourcetype=web_traffic client_ip="198.51.100.55" AND path IN ("*bunnylock.bin*", "*shell.php?cmd=*") | table _time, path, user_agent, status

➜ Important Additional Information

• Active webshell detected
• Ransomware execution observed: /shell.php?cmd=./bunnylock.bin


-- Correlate Outbound C2 Communication --

Correlation of web traffic with firewall logs to confirm command-and-control communication.

Search query: sourcetype=firewall_logs src_ip="10.10.1.5" AND dest_ip="198.51.100.55" AND action="ALLOWED" | table _time, action, protocol, src_ip, dest_ip, dest_port, reason

This query proves the server immediately established an outbound connection to the attacker's C2 IP on the suspicious DEST_PORT. The ACTION=ALLOWED and REASON=C2_CONTACT fields confirm the malware communication channel was active.

➜ Important Additional Information

• Outbound C2 communication confirmed
• reason=C2_CONTACT indicates malware activity


-- Volume of Data Exfiltrated --

Measurement of the total amount of data exfiltrated from the compromised server.

Search Query: sourcetype=firewall_logs src_ip="10.10.1.5" AND dest_ip="198.51.100.55" AND action="ALLOWED" | stats sum(bytes_transferred) by src_ip

The results show a hugh volume of data transferred from the compromised webserver to C2 server.

➜ Important Additional Information

• Large volume of outbound data
• Confirms successful data exfiltration


-- Conclusion --

• Identity found: The attacker was identified via the highest volume of malicious web traffic originating from the external IP.
• Intrusion vector: The attack followed a clear progression in the web logs (sourcetype=web_traffic).
• Reconnaissance: Probes were initiated via cURL/Wget, looking for configuration files (/.env) and testing path traversal vulnerabilities.
• Exploitation: The use of SQLmap user agents and specific payloads (SLEEP(5)) confirmed the successful exploitation phase.
• Payload delivery: The Action on Objective was established by the final successful execution of the command cmd=./bunnylock.bin via the webshell.
• C2 confirmation: The pivot to the firewall logs (sourcetype=firewall_logs) proved the post-exploitation activity. The internal, compromised server (SRC_IP: 10.10.1.5) established an outbound C2 connection to the attacker's IP.




*
