
--- Windows Fundamentals ---

● Introduction to Windows
● Windows Filesystems
● Directory Structure
● Windows Command Line
● Windows Users and Groups
● Permissions Management on Windows
● Windows Process Management
● Windows Services
● Task Scheduler Windows
● Windows Firewall
● Event Logs
● Windows Management Instrumentation (WMI)


-- Introduction to Windows --

What is Windows?
Windows is the name of the operating system family that has many different versions developed by Microsoft. The Windows operating system was first released in 1985. Many versions of Windows have been released since the day it was released. It has been continuously improved in every version and it still continues to be developed. Today, it is possible to come across a Windows product in every environment where technology is available. 

Usage Areas of Windows
The Windows operating system and its family are widely used. It is frequently used in the industrial field and mobile devices, especially in the IT sector. Different windows versions have been released according to needs and usage areas. 


-- Windows Filesystems --

What is File System?
A file system is a data structure that maintains the order of digital storage areas, and whose unit is a file. The operating system cannot make sense of the spaces on the disk without the file system. It cannot know which data group is on the disk as a file. So the file system is a very important component for running the operating system. File systems have different types and data structures. This data structure can be different for each file system

File Systems Used in Windows
File systems have also been developed, like every technology that has developed from the past to the present. With the development of technology, the need for new file systems has emerged due to increased processing power and storage capacity. Therefore, different file systems have been developed continuously and released to the market. Some of these file systems used in Windows operating systems are given below. 

1. FAT
The File Allocation Table (FAT) file system was developed and released for personal computers in 1977. Although the purpose of its emergence was to be used on floppy disks, it was adapted to be used in hard drives and other devices over time. The FAT file system is not the default file system for Microsoft Windows operating systems today. Today, it is used in USB flash drives, flash drives, and other embedded systems. 

2. exFAT
exFAT (Extensible File Allocation Table) is a file system introduced by Microsoft in 2006 and optimized for flash memory such as USB flash drives and SD cards. (Source: Wikipedia) 

3. NTFS
New Technology File System (NTFS) was announced and started to be used with the Windows NT 3.1 version in 1993. It was used as the default file system within the Windows operating system with this version and it still is. It replaced FAT file system as it is a more advanced file system that is suitable for new technologies. In addition, the NTFS file system also supports Linux and BSD systems. 

It is of great importance for SOC analysts to know the technical details of the NTFS file system considering that it is predominantly used in Windows operating systems as the latest technology today. Knowing the structure of the file system ensures that the security-oriented inferences to be obtained in the analyses are more and more consistent for analysts who perform host analysis. In order to have further information on this topic, detailed information can be obtained by conducting research under the name of "Filesystem Forensics". 


-- Directory Structure --

What is Directory Structure?
As in every operating system, the folder and file structure in Windows takes place in a certain order from the first installation. This order is determined by the company/person that developed the operating system. 
Although windows versions have similar folder structures in general, some folders and files may differ depending on the version of the operating system. The examples in this training are shown on the "Windows Server 2019 Datacenter". 
In Windows, the root directory is "drive:\", for example, the root directory is usually "C:\". The directory separator is usually a "\", but the operating system also internally recognizes a "/". Physical and virtual drives are named by a drive letter, as opposed to being combined as one.

Directories in Windows
The directory structure is created as follows when Windows is first installed. 
- PerfLogs
- Program Files
- Program Files (x86)
- ProgramData
- Users
- Windows

1. PerfLogs
It is the folder created to keep Windows performance logs. It is found as an empty folder because the logging option is turned off by default. 

2. ProgramData
The ProgramData folder is located as a hidden folder under the root of the disk where the Windows operating system is installed. The "Hidden Items" option must be activated under the "View" menu first to be able to see the folder. There are data belonging to the programs installed in the system, independent from the user accounts in this folder. 

3. Program Files
All the programs installed in the system are located under the "Program Files" folder in a Windows operating system installed as 32-bit. In Windows operating systems installed as 64-bit, only 64-bit programs are installed under this folder. 

4. Program Files (x86)
This folder is only available on Windows operating systems installed as "64-bit". There are programs installed on the system as "32-bit" under this folder. Programs installed as "64-bit" are stored in another folder named “Program Files” with a similar name.

5. Users
The Users folder contains the personal folder of each user who has logged on to the system at least once. Folders and documents such as desktop folder, downloaded files, and documents are stored under this folder that belongs to each user on the system. 

6. Windows
The Windows folder is where the entire operating system is installed. It has its own structure and it contains many systemic information in a certain order. For example, the database where users' passwords are kept is located under this folder. 


-- Windows Command Line --

What is the "Command Line"?
The command line is an intermediary program that receives the commands from the user via the keyboard and transfers them to the operating system for execution. 

- Basic Commands -
Basic Commands
In Windows, many operations can be done through the command line. Below are some commands that are basically used in the Windows operating system. 

1. "Help" Command
The "Help" is the command that provides detailed information about the commands used on the command line. We can see the parameters of the commands that we need to get information with the "Help" command. 

C:\Users\mirko>help dir
Displays a list of files and subdirectories in a directory.

DIR [drive:][path][filename] [/A[[:]attributes]] [/B] [/C] [/D] [/L] [/N]
  [/O[[:]sortorder]] [/P] [/Q] [/R] [/S] [/T[[:]timefield]] [/W] [/X] [/4]

  [drive:][path][filename]
              Specifies drive, directory, and/or files to list.

  /A          Displays files with specified attributes.
  attributes   D  Directories                R  Read-only files
               H  Hidden files               A  Files ready for archiving
               S  System files               I  Not content indexed files
               L  Reparse Points             O  Offline files
               -  Prefix meaning not
  /B          Uses bare format (no heading information or summary).
  /C          Display the thousand separator in file sizes.  This is the
              default.  Use /-C to disable display of separator.
  /D          Same as wide but files are list sorted by column.
  /L          Uses lowercase.
  /N          New long list format where filenames are on the far right.
  /O          List by files in sorted order.
  sortorder    N  By name (alphabetic)       S  By size (smallest first)
               E  By extension (alphabetic)  D  By date/time (oldest first)
               G  Group directories first    -  Prefix to reverse order
  /P          Pauses after each screenful of information.
  /Q          Display the owner of the file.
  /R          Display alternate data streams of the file.
  /S          Displays files in specified directory and all subdirectories.
  /T          Controls which time field displayed or used for sorting
  timefield   C  Creation
              A  Last Access
              W  Last Written
  /W          Uses wide list format.
  /X          This displays the short names generated for non-8dot3 file
              names.  The format is that of /N with the short name inserted
              before the long name. If no short name is present, blanks are
              displayed in its place.
  /4          Displays four-digit years

Switches may be preset in the DIRCMD environment variable.  Override
preset switches by prefixing any switch with - (hyphen)--for example, /-W.

C:\Users\mirko>

2. "Dir" Command
The "Dir" is the command that lists the files and the folders under the current directory. For example, let's see the files and folders under "C:\Users\LetsDefend": 

3. "Cd" Command
The "Cd" is the command that is used for directory transitions. For example, let's switch from the "C:\Windows" directory to the "C:\Windows\system32" directory: 

4. "Date" Command
The "Date" is the command that is used to view and change the system's date information. For example, let's see the date information with the "date /t" command:

C:\Users\mirko>date /t
26.11.2024

5. "Echo" Command
The "Echo" is the command that is used to print to the screen. For example, let's print "BlueTeam" to the screen with the echo command: 

C:\Users\mirko>echo "Hi all there ;-)"
"Hi all there ;-)"

C:\Users\mirko>

6. "Hostname" Command
The "Hostname" is the command that is used to see the hostname information of the system.

C:\Users\mirko>hostname
cyberpunk

7. "Time" Command
The "Time" is the command that is used to see the system time. For example, let's see the system time with the command "time /t": 

C:\Users\mirko>time /t
20:38

- Network Commands -

1. "Ipconfig" Command
The "Ipconfig" is the command that allows viewing information about network interfaces on the system via the command line.
Note: In order to get detailed information about all network interfaces, the "ipconfig" command should be used with the "/all" parameter.

2. "Netstat" Command
It is possible to view the current network connections and their statuses via the netstat command. 

Note: Since the output of the netstat command is too long, only the first part is displayed in the above image.

- "-a" parameter : Displays all connections and listening ports.
- "-n" parameter : Displays addresses and port numbers in numerical form.
- "-o" parameter : Displays the owning process ID associated with each connection.

3. "Nslookup" Command
Devices communicate with each other through numerical values in the IT world. Therefore, values that do not correspond to numerical values need to find their numerical equivalents. For example, when trying to access the "letsdefend.io" domain, the IP address of the target DNS server must be known or learned. In this case, an intermediary should perform a domain name and IP address resolution and report the IP address of the DNS server of the desired domain. It is the Domain Name System (DNS) protocol that carries out this task. There are some tools and commands used for this. For example, let's find the DNS server IP address of the "letsdefend.io" address with the "nslookup" tool: 

C:\Users\mirko>nslookup letsdefend.io
Server:  fritz.box
Address:  fd00::d624:ddff:fede:5fd

Non-authoritative answer:
Name:    letsdefend.io
Addresses:  18.102.16.191
          35.152.119.144
          35.152.104.113


C:\Users\mirko>

4. "Ping" Command
It may be needed to test the network communication of two different devices within the same network. It is possible to find out whether the target is accessed with the "ping" command on the command line. Network packet(s) are sent to the destination and awaited for the response with the "ping" command. In this way, it can be tested whether there is network communication with the destination address. 

Note: As a security measure, the target system may be configured to not to respond to the "ping" command to prevent attackers from conducting network and host discovery. The examples below assume that this is not the case.

Note: "-n" parameter: Number of echo requests to send.

C:\Users\mirko>ping -n 5 google.com

Pinging google.com [2a00:1450:4001:828::200e] with 32 bytes of data:
Reply from 2a00:1450:4001:828::200e: time=36ms
Reply from 2a00:1450:4001:828::200e: time=21ms
Reply from 2a00:1450:4001:828::200e: time=20ms
Reply from 2a00:1450:4001:828::200e: time=59ms
Reply from 2a00:1450:4001:828::200e: time=39ms

Ping statistics for 2a00:1450:4001:828::200e:
    Packets: Sent = 5, Received = 5, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 20ms, Maximum = 59ms, Average = 35ms

C:\Users\mirko>

5. "Systeminfo" Command
The "Systeminfo" is the command that provides detailed information about the system.
Note : Since the output of the "systeminfo" command is too long, only the first part is displayed in the image.

- File Operations Commands -

File Operations Commands
This section covers commands for operations performed on files. 

1. "Type" Command
 The "type" is the command that is used to print the file content to the screen. 

C:\Users\mirko>type .bash_history
ls
pwd
cd
pwd
cd ..
pwd
cd ..
ls -l
clear
fsutil fsinfo drive
cleae
clear
fsutil fsinfo drives
pwd
mkdir metasploitable3-win2k8
rm metasploitable3-win2k8/
rm -rf metasploitable3-win2k8/
mkdir vagrantvms
cd vagrantvms/
mkdir metasploitable3-win2k8

2. "Copy" Command
The "copy" is the command that is used in file copy operations. The first parameter in the "copy" command is the path of the file to be copied. The second parameter is the target path. For example, let's copy the file "file.txt" with a copy in the same directory: 

C:\Users\mirko>type file.txt copyfile.txt

The image above shows that the file "file.txt" was successfully copied and a new file named "copyfile.txt" was created. 

3. "Mkdir" Command
The "mkdir" is the command that is used to create a new directory. It stands for "make directory". 

4. "Rename" Command
The "rename" is the command to rename files. For example, let's rename the file "file.txt" to "file2.txt": 

C:\Users\mirko>rename file.txt file2.txt

5. "Move" Command
The "move" is the command that is used to move files. For example, let's move the "file2.txt" file under the directory named "incident": 

C:\Users\mirko>move file.txt incident\

6. "Tree" Command
The "tree" is the command that allows listing nested directories with a single command. For example, let's list the folders under the "C:\Users\LetsDefend" directory: 

C:\Users\mirko>tree
Folder PATH listing for volume OS
Volume serial number is 44D2-A202
C:.
├───.gem
│   └───specs
│       ├───api.rubygems.org%443
│       │   └───quick
│       │       └───Marshal.4.8
│       └───gems.hashicorp.com%443
│           └───quick
│               └───Marshal.4.8
├───.Icecream Screen Recorder
│   └───log
├───.icesoft
│   └───icepdf-viewer
│       └───_syslock
├───.local
│   └───share
│       └───gem
│           └───specs
│               ├───gems.hashicorp.com%443
│               │   └───quick
│               │       └───Marshal.4.8
│               ├───index.rubygems.org%443
│               │   └───quick
│               │       └───Marshal.4.8
│               └───rubygems.org%443
...
...
...
...

8. "Rmdir" Command
The "rmdir" is the command that is used to delete directories. For example, let's delete the directory named "incident": 
When "rmdir" command is run without parameters, directory deletion is not performed because the directory to be deleted must be empty in order for "rmdir" command to work without parameters. Therefore, it is necessary to use the command with a parameter. When the command is run, a warning will be prompted and if confirmed, the directory will be deleted. 

Note: "/S" parameter: Removes all directories and files in the specified directory in addition to the directory itself. It is used to remove a directory tree.
We covered what the command line is, the importance of the command line in terms of security, and some of the basic commands in this part of the training. You can find other helpful commands and further detailed information on the Windows command line at the following addresses:

https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands
https://ss64.com/nt/


-- Windows Users and Groups --

About the Users and Groups
There are users and groups on the Windows operating system. The privileges and duties of users and groups on the system may differ. Attackers want to capture the most authorized user on the system. Therefore, the users and the groups they belong to are important from a security point of view. Attackers targeting Windows operating systems want to know what user privileges they have when they are able to send commands to the operating system because what they can do with a lower user profile may be limited. The attacker will attempt to attack back to increase the user authority after he/she figures out that he/she has access to the system with a low user profile. On the defensive side, what the analysts should do is to monitor user activities and detect anything suspicious within a short period of time.

"Whoami" Command
"whoami" is the command that shows which user account accessing the system.

C:\Users\mirko>whoami
cyberpunk\mirko

Note: The format in the whoami command output is "domain\username". If the host that’s making this search is not included in the domain, then the hostname information is displayed instead of the domain.

1. "net user" command
"net user" is the command that displays the usernames within the system. For example, let's see the usernames in the system by executing the command: 

C:\Users\mirko>net user

User accounts for \\CYBERPUNK

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
mirko                    WDAGUtilityAccount
The command completed successfully.

If detailed information is desired for a user in the system, a username should be given as a parameter to the "net user" command. For example, let's see the information of the user "Administrator": 

C:\Users\mirko>net user Administrator
User name                    Administrator
Full Name
Comment                      Built-in account for administering the computer/domain
User's comment
Country/region code          000 (System Default)
Account active               No
Account expires              Never

Password last set            26.11.2024 21:19:52
Password expires             Never
Password changeable          26.11.2024 21:19:52
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   16.10.2022 03:52:29

Logon hours allowed          All

Local Group Memberships      *Administrators
Global Group memberships     *None
The command completed successfully.

C:\Users\mirko>

2. "net accounts" command
"net accounts" command allows users to see the configurations related to password usage and logon restrictions on the system. For example, let's see the command by executing it: 

C:\Users\mirko>net accounts
Force user logoff how long after time expires?:       Never
Minimum password age (days):                          0
Maximum password age (days):                          42
Minimum password length:                              0
Length of password history maintained:                None
Lockout threshold:                                    10
Lockout duration (minutes):                           10
Lockout observation window (minutes):                 10
Computer role:                                        WORKSTATION
The command completed successfully.

C:\Users\mirko>

As seen in the image above, some configurations related to all of the users on the system have been successfully displayed on the screen. 

3. "net localgroup" command
"net localgroup" is the command that allows us to perform operations related to groups on the system. If it is used with parameters, different operations can be executed on groups. When used without parameters, it only displays the list of groups on the system. For example, let's see the groups on the system by executing the command without parameters: 

C:\Users\mirko>net localgroup

Aliases for \\CYBERPUNK

-------------------------------------------------------------------------------
*__vmware__
*Access Control Assistance Operators
*Administrators
*Backup Operators
*Cryptographic Operators
*Device Owners
*Distributed COM Users
*Event Log Readers
*Guests
*Hyper-V Administrators
*IIS_IUSRS
*Network Configuration Operators
*Performance Log Users
*Performance Monitor Users
*Power Users
*Remote Desktop Users
*Remote Management Users
*Replicator
*System Managed Accounts Group
*Users
The command completed successfully.

C:\Users\mirko>

If you want to see the information of a group in the system, the group name should be added as a parameter to the "net localgroup" command. For example, let's see the information for the "Administrators" group: 

C:\Users\mirko>net localgroup Administrators
Alias name     Administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
mirko
The command completed successfully.

C:\Users\mirko>


User and Group Management via Graphical User Interface (GUI)
- lusrmgr.msc
- gpedit.msc


-- Permissions Management on Windows --

Permissions Management on Windows
Permission management is one of the most important topics to ensure the overall operating system security. The system’s permissions management must be configured carefully. Each system has its own permissions management configuration. Windows has its own permissions management features as well. 

File and Folder Permissions
Each user has its own profile and permissions to prevent unauthorized access to files/folders. Normally, every file/folder gets its permissions from the parent folder in the Windows environment. This hierarchy continues up to the root directory of the hard drive. A user's ability to operate on a file is managed by the granted permissions. 

Viewing File permissions
File permissions operations can be performed via the Graphical User Interface (GUI) easily. For example, suppose we have a file named “file.txt” whose owner is the “LetsDefend” user. Let's right-click on the file and open the "properties" window and switch to the "security" tab
The file permissions have been successfully displayed. This “properties” window contains the list of users and groups and displays the permissions for the selected user/group. If the check mark indicating that the user is allowed for specific permissions types is grayed out, that means that this file inherits its permissions from another folder. If permissions are changed manually, then the checkmark will be in black color. 

Permissions Types
There are 6 different permissions types when managing file permissions: Full Control, Modify, Read&Execute, Read, Write, and Special permissions. The following table provides more information on the permissions types

Read*             
Permits viewing and listing of files and subfolders
Permits viewing or accessing of the file's contents

Write*            
Permits adding of files and subfolders 
Permits writing to a file

Read & Execute*
Permits viewing and listing of files and subfolders as well as executing of files; inherited by files and folders 
Permits viewing and accessing of the file's contents as well as executing of the file

Modify*
Permits reading and writing of files and subfolders; allows deletion of the folder
Permits reading and writing of the file; allows deletion of the file

Full Control*
Permits reading, writing, changing, and deleting of files and subfolders
Permits reading, writing, changing and deleting of the file

Changing file permissions
Changing the file permissions requires one to be the owner of that file. For example, let's see who owns the file “file.txt”. Let’s right-click on the file and open the "properties" window, then click the "advanced" button in the "security" tab

The owner of the file is the "LetsDefend" user. Since we are logged into the system as the "LetsDefend" user, we can make changes on the permissions on this file.
Let's remove the "Read" permissions of the "LetsDefend" user to prevent his/her access to this file. In the security tab of the file’s properties window, let's select the "LetsDefend" user and make changes to the file permissions with the "Edit" button
We put a checkmark for the reading abilities of this user under the “deny” column that will ensure that the files will not be accessed by the “LetsDefend” user. 
Let's try to read the "file.txt" after making the changes as in the image above: 
When we tried to open the file, we receive an error message indicating that we don't have permission to access the file. Users without administrator privileges on the Windows environment are normally not able to access other directories that don’t belong to them. 
Let's try to read the "file.txt" after making the changes as in the image above: 
When we tried to open the file, we receive an error message indicating that we don't have permission to access the file. Users without administrator privileges on the Windows environment are normally not able to access other directories that don’t belong to them. For example, let's login to the "user2" account and try to access the directory of the "user1" account: 
As we see in the image above, we receive an error message indicating that we don't have permission to access to this folder. When we click on the "Continue" button to access, it requires us to login with the administrator credentials
Even if the user logs in with the administrator credentials he/she may still not be able to access the file without the read permissions on the file. 


User Account Control (UAC)

What is User Account Control (UAC)?
User Account Control (UAC) is a security feature in Windows operating systems to prevent unauthorized access. With this feature, certain changes and operations cannot be made without administrator permission. The error message for the administrator permission request in the example above is due to this feature. Although it increases the system security, this feature can be bypassed and violated by attackers from time to time. While it is not a good practice to rely only on this feature to ensure system security, it is also not a good practice not to use this feature. While performing security hardening of the system, "User Account Control" configurations should be applied carefully and correctly, like many other features. 

What is the difference among UAC levels in Windows?
We can access the UAC settings, see different levels, and make changes through the “Security and Maintenance” in the settings menu in the Windows operating system

UAC has 4 different levels: 
1. Always notify: At this level, you are notified before applications and users make changes that require administrative permissions. This is the most secure setting and the most annoying. 
2. Notify me only when apps try to make changes to my computer (default): This is the default level, and UAC notifies you only before programs make changes that require administrative permissions. This is less secure than the first setting because malicious programs can be created to simulate the keystrokes or mouse movements made by a user and change Windows settings.
3. Notify me only when apps try to make changes to my computer (do not dim my desktop): This level is identical to the previous setting except for the fact that, when a UAC prompt is shown, the desktop is not dimmed and other desktop apps can interfere with it. This level is even less secure as it makes it even easier for malicious programs to simulate keystrokes or mouse moves that interfere with the UAC prompt.
4. Never notify me: At this level, UAC is turned off, and it doesn't offer any protection against unauthorized system changes. If you don't have a good security suite you are very likely to encounter security issues with your Windows device. With UAC turned off it is much easier for malicious programs to infect Windows and take control.


-- Windows Process Management --

What is Process?
A process is a program under execution in an active program. Processes are the units of commands/programs running on the operating system. Mainly the processes are examined during the live Windows host review. Examination and analysis of memory essentially actually mean the analysis of processes. Each process has its own identification number in the Windows environment which is called "Process ID" (PID) and they are logged in each process operation. 

Process Tree
Running a program is a process. From this process, another process can be created. There is a parent-child relationship between the two processes. 
Process: A process is a program under execution in an active program.
Parent Process: In computing, a parent process is a process that has created one or more child processes.
Child Process: A child process in computing is a process created by another process (the parent process). A parent process may have multiple child processes, but a child process only one parent process.

Sources:
https://www.geeksforgeeks.org/difference-between-process-parent-process-and-child-process
https://en.wikipedia.org/wiki/Child_process
https://en.wikipedia.org/wiki/Parent_process

The hierarchical representation of parent processes and child processes is called the "Process Tree". There are some useful tools available for viewing the Process Tree. "Process Hacker" is one of the many of them. Process hacker is a free and open source tool. With this tool, all processes running in the Windows operating system can be monitored in real-time. The "Process Hacker" tool can be downloaded from: 
The "Process Hacker" tool displays the processes in Windows in hierarchical order. 

As seen for example "explorer.exe" is the parent process with the following 3 child processes: 
• Tvnserver.exe
• ProcessHacker.exe
• SnippingTool.exe

Although all of these processes are totally different processes, there is a parent-child relationship between all these. In this window, it is clearly seen that there are processes with or without child processes and even some with no child processes. 

Process Hacker
https://processhacker.sourceforge.io

Windows Legitimate Processes
There are many Windows native processes with different tasks. Let’s see some of the important processes from a security point of view due to their current authorizations, and the user and system information they contain. 

wininit.exe
The “wininit.exe” process is known as the “Windows Initilization Process”. It is responsible for starting the Service Control Manager (services.exe), Local Security Authority process (lsass.exe), and Local Session Manager (lsm.exe). It is located under the “C:\Windows\System32” folder. It is created during system boot. It is the process that works with the privileges of the most authorized user (NT AUTHORITY\SYSTEM) on the system. 

services.exe
The “services.exe” is the process responsible for starting and stopping services. “Svchost.exe”, “dllhost.exe”, “taskhost.exe”, and “spoolsv.exe” are child processes of the “Services.exe” process. It is located under the “C:\Windows\System32” folder. It is the process that works with the privileges of the most authorized user (NT AUTHORITY\SYSTEM) on the system. There should only be 1 "services.exe" process at a time in the process tree under normal conditions. If there are multiple "services.exe" processes or if there is a process with a similar name, it should be investigated further as it may be a process that belongs to a malicious activity. 

svchost.exe
“Svchost.exe” is a generic host process name for services that run from dynamic-link libraries. Because DLL files are non-executable files, they are run with svchost for triggering the services of the operating system. “svchost.exe” is responsible for the usage and management of multi-dll services for the optimization of system sources. All DLL-based services share the same svchost process. Every svchost process occurs with executing unique services. It's parent process is “services.exe”. And "Services.exe" is the child process of "wininit.exe". 
“Svchost.exe” is located under the “C:\Windows\System32” folder. This is the process running on the system with “NT AUTHORITY\NETWORK SERVICE” or NT AUTHORITY\SYSTEM” privileges.
https://alparslanakyildiz.medium.com/fundamental-windows-processes-6341696cf4f0

lsass.exe
The “lsass.exe” (Local Security Authority Subsystem Service) is the process responsible for critical security operations such as confirming or rejecting users' passwords during login in the Windows operating system. In addition, this process works actively during the password changes of users. This process is critically important as it contains the user passwords in the system. The attacker gaining access to the system can obtain the user's password by leveraging this process. There is a free tool called “mimikatz” developed by “Benjamin Delpy” and users' passwords can be obtained from the "lsass.exe" process with the help of the “Mimikatz” tool. It can be accessed at the following address: 
“lsass.exe” is located under the “C:\Windows\System32” folder. It is the process that works with the privileges of the most authorized user (NT AUTHORITY\SYSTEM) on the system.
Mimikatz: https://blog.gentilkiwi.com/mimikatz 

winlogon.exe
The “Winlogon.exe” is the process that performs the login and logout operations of the users in the Windows operating system. It is the process that works with the privileges of the most authorized user (NT AUTHORITY\SYSTEM) on the system. “Winlogon.exe” is located under the “C:\Windows\System32” folder. 

explorer.exe
The “Explorer.exe” process is the parent process of almost every process that has a graphical user interface (GUI) in the Windows operating system and opens as a window. For example, this process kicks in when Windows explorer is started. Under normal circumstances, one "explorer.exe" process is expected. “Explorer.exe” is located under the “C:\Windows\” folder. This process runs with the privileges of the user who is currently logged in to the system. 

Task Manager
“Task Manager" is the application that enables to see and manage the processes on Windows operating system. The processes can be viewed and terminated with the help of the “Task Manager”. It has a graphical user interface (GUI)
The "processes" tab of the task manager application provides limited and general information about processes. Detailed information about the processes can be viewed under the "details" tab. 

Process Operations Commands
Windows process operations are generally performed via the Graphical User Interface (GUI). In some exceptional cases, we may need to perform process operations via the command line. Let’s see some of the important commands that we may need to use for various tasks: 

Tasklist command
The "Tasklist" command allows us to see the list of processes running on the system.

C:\Users\mirko>tasklist

Image Name                     PID Session Name        Session#    Mem Usage
========================= ======== ================ =========== ============
System Idle Process              0 Services                   0          8 K
System                           4 Services                   0        152 K
Secure System                  204 Services                   0     84.424 K
Registry                       236 Services                   0     57.992 K
smss.exe                       812 Services                   0      1.124 K
csrss.exe                     1244 Services                   0      5.884 K
wininit.exe                   1372 Services                   0      5.948 K
services.exe                  1444 Services                   0     15.920 K
LsaIso.exe                    1456 Services                   0      3.304 K
lsass.exe                     1476 Services                   0     27.120 K
svchost.exe                   1604 Services                   0     33.896 K
fontdrvhost.exe               1624 Services                   0      2.840 K
svchost.exe                   1720 Services                   0     18.368 K
svchost.exe                   1764 Services                   0     11.124 K
WUDFHost.exe                  1824 Services                   0     16.988 K
WUDFHost.exe                  1888 Services                   0     13.580 K
WUDFHost.exe                  1940 Services                   0      7.488 K
svchost.exe                   1736 Services                   0      4.960 K
svchost.exe                   1788 Services                   0     11.344 K
svchost.exe                   1632 Services                   0     10.140 K
svchost.exe                   1864 Services                   0      4.976 K
svchost.exe                   2096 Services                   0     10.108 K
svchost.exe                   2140 Services                   0     10.264 K

As seen in the screenshot above, the "Tasklist" command helps us display the information of the running processes on the system. 

taskkill command
The "Taskkill" is the command used to terminate the processes running in the system. In order to execute this command, the “PID (Process ID)” value of the process to be terminated must be known. The PID value is a numerical identification value given to the processes by the system in order to distinguish the processes from each other. For example, let's see the PID value of the "osk.exe (screen keyboard)" process we want to terminate: 

C:\Users\mirko>tasklist | findstr OpenConsole.exe
OpenConsole.exe              33492 Console                    3     14.616 K

C:\Users\mirko>

As seen in the image above, the PID value of the "OpenConsole.exe" process is seen as "33492". 

Note: The Pipe(|) sign allows you to give the output of one command as an input to another command. The “findstr” command (string search) is the command used in searches. Let's give the PID value as a parameter to the "taskkill" command and end the process:

Terminate the process named “OpenConsole.exe” with a PID value of 33492 with the “taskkill /PID 33492” command. 

C:\Users\mirko>taskkill /PID 33492


-- Windows Services --

What are Services?
Services are programs that have their own processes running in the background on Windows. Services can run without interacting with the user and needing to open a window on the screen. Each service has its own reason for running. As the system has its own services, there may also be services belonging to the programs installed later in the system. Services running on Windows are important from the security aspect. Attackers can gather information about the system through running services or use services to infiltrate the system. If there is an incident or suspicious activity, the SOC analysts should monitor the processes of all services, including the services added to the system through the event logs to be able to detect any suspicious activities. A newly created service with a potentially suspicious name may indicate an attacker's activity. In this part of the training, we will cover the Windows services.

Note: Event logs will be explained in the following parts of the training. 

- Managing Windows Services with a Graphical User Interface (GUI) -

(Windows + R) + services.msc
The status of the services can be seen and the services can be started and stopped
The "Path to executable" section contains the command that will run after the service is activated. This command may have essential hints about the attacker.

- Managing Windows Services with Command Line -

Manage Windows services from the command line: sc
Display all running services: sc query
View all services: sc query type=service state=all
Get information about the service: sc query wuauserv
Starting and Stopping the Service: sc start wuauserv | sc stop wuauserv

The most important thing we should pay attention here is that the command line must be opened with administrator privileges before executing the service stop command. If the command line is not opened with administrator privileges, the service stop command will not work and will result in an authorization error


-- Task Scheduler Windows --

What is a scheduled task?
A scheduled task is the execution of certain operations on the system at certain time intervals or at certain times. For example, we may need to check the system information at certain time intervals. Scheduled tasks implement these types of tasks in the Windows operating system. Once an attacker gains access to the Windows system, he/she can utilize the scheduled tasks to ensure persistence by making the system send connection requests to his/her own system in order not to lose access to the system. This requires adding a new task to the scheduled tasks. When detecting threats, the SOC analyst should monitor the scheduled tasks closely to be able to detect suspicious scheduled tasks. 

- Managing Scheduled Tasks with the GUI -

Manage scheduled tasks: (Windows + R) + taskschd.msc

Creating a new scheduled task: 
• Click on the "Create Task" button
• Fill the name and description of the task
• Go to the "Actions" tab and add the action that the scheduled task will do. If there is no "action" in this section adding a task cannot be completed
• To run the scheduled task, we can right click and select "Run"

View scheduled tasks: schtasks
Getting information about the scheduled task: schtasks /Query /TN TrainingTask
Enable the Scheduled Task: schtasks /Change /ENABLE /TN TrainingTask
Running the scheduled task via command line: schtasks /Run /TN TrainingTask
Terminating the scheduled task via the command line: schtasks /End /TN TrainingTask
Deleting scheduled task via command line: schtasks /Delete /TN TrainingTask


-- Windows Registry --

What is Windows Registry?
Windows Registry is a hierarchical database that contains the operating system and system configurations related to the programs installed in the system. It keeps the information and settings of programs and hardware in this database. For example, when a program is installed on Windows, the program may choose to keep the expiry date of its license in the Windows Registry.
Windows Registry is an important component in Windows for attackers. The registry contains a lot of information about the Windows operating system. For example, information about programs that were installed on the system and uninstalled later may still remain in the registry. The information that the attackers want to obtain through the system is usually the information necessary for the continuation of the attack. For example, when the attackers seize the user accounts with limited privileges, they will probably keep hunting for those with higher privileges by collecting information about other users in the system.
The Registry contains important configurations and information about the system, as well as information about other programs installed on the system. Attackers may also want to add their own entries to the registry to be able to ensure persistence in the system. The SOC analyst should monitor suspicious changes to the registry to be able to detect any suspicious activities and behaviors of the attacker. 

Accessing the Registry: (Windows + R) + regedit

- Registry Structure -

Windows registry entries are located at "%SystemRoot%\System32\Config".

The registry contains two essential elements: "keys" and "values". Registry keys are container objects similar to folders. Registry values ​​are non-container objects similar to files. Keys may contain values ​​and subkeys.

E.g. HKEY_LOCAL_MACHINE\Software\Microsoft\Windows refers to the subkey "Windows" of the subkey "Microsoft" of the subkey "Software" of the HKEY_LOCAL_MACHINE root key.

There are seven predefined root keys :

HKEY_LOCAL_MACHINE or HKLM
HKEY_CURRENT_CONFIG or HKCC
HKEY_CLASSES_ROOT or HKCR
HKEY_CURRENT_USER or HKCU
HKEY_USERS or HKU
HKEY_PERFORMANCE_DATA (only in Windows NT, but invisible in the Windows Registry Editor)
HKEY_DYN_DATA (only in Windows 9x, and visible in the Windows Registry Editor)

HKEY_LOCAL_MACHINE or HKLM
It is the section where computer-specific hardware and software configuration information is kept. Settings applicable to each logged-in user are maintained in this section. There are some important subkeys below this key: 

• HARDWARE This section contains information about the hardware devices connected to the system.
• SAM This section contains the encrypted versions of the passwords of the users.
• SECURITY It is the section that contains the security policies in the system.
• SOFTWARE This section contains the configurations of the operating system services as well as the programs installed in the system.
• SYSTEM It is the section where the configuration information of the system is kept. 

HKEY_CURRENT_CONFIG or HKCC
It is the section that keeps the hardware configurations during the operation of the system.

HKEY_CLASSES_ROOT or HKCR
It contains software settings, shortcuts, and all other user interface-related information. If this partition is deleted, none of the files will open, even if Windows is running.

HKEY_CURRENT_USER or HKCU
This is the section where the configurations of the logged-in user are kept.

HKEY_USERS or HKU
It is the section where the configurations of all users registered to the system are kept. 

Reg extension files
Files with the “Reg” extensions are the file format saved when exporting the registry files. The structure of the “Reg” extension which is a text-based file type, is as follows: [<Hive name>\<Key name>\<Subkey name>] "Value name"=<Value type>:<Value data>

- Registry Operations on the Command Line -

Computer Name: reg query HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\ComputerName\ComputerName
Find User Run Programs: reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run /s
Find System Run Programs: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run /s
Check Startup Locations: reg query HKLM\SYSTEM\CurrentControlSet\Services /s
Audit Recently Opened Files: reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs /s
Find Installed Programs: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall /s
Identify User NTUSER Hive: reg query HKCU\Software\Microsoft\Windows\CurrentVersion
Retrieve Network Configurations: reg query HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /s
Check USB Device History: reg query HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR /s
Find Mapped Drives: reg query HKCU\Network /s
Identify Auto-Login Credentials: reg query HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
Extract Shell Bags: reg query HKCU\Software\Microsoft\Windows\Shell\BagMRU /s
Review RunOnce Keys: reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce /s
Find Cached Credentials: reg query HKLM\SECURITY\Policy\Secrets /s
Check Firewall Rules: reg query HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile /s
Audit Proxy Settings: reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings /v ProxyServer
Analyze User Typed URLs: reg query HKCU\Software\Microsoft\Internet Explorer\TypedURLs /s
Investigate RDP History: reg query HKCU\Software\Microsoft\Terminal Server Client\Default /s
Find Scheduled Tasks: reg query HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks /s
Check Installed Drivers: reg query HKLM\SYSTEM\CurrentControlSet\Control\Class /s
Look for Malware Persistence: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run /s


Reg Command: https://ss64.com/nt/reg.html 


-- Windows Firewall --

What is Windows Firewall?
Windows Firewall is a security tool that allows blocking or allowing incoming network packets to the host machine and outgoing network packets from the host machine within the framework of certain rules. This will easily block the malicious connections with rules created on the Windows firewall. At the same time, destinations that are verified as secure connections can be added to the allowed network connections through new rules. 

Inbound And Outbound Rules
An inbound rule filters traffic that passes from a network to a local computer based on the rules’ parameters. For outbound rules, traffic sent from local computers to the network should be filtered according to the filtering rules. 

Firewall Rules Management with the Graphical User Interface (GUI): wf.msc

- Retrieve Firewall Rules -

Show all firewall rules: netsh advfirewall firewall show rule name=all
Show specific rule details: netsh advfirewall firewall show rule name="RuleName" 
Show inbound rules: netsh advfirewall firewall show rule name=all dir=in
Show outbound rules: netsh advfirewall firewall show rule name=all dir=out
Show rules by group: netsh advfirewall firewall show rule name=all group="GroupName"
Check blocked ports: netsh advfirewall firewall show state
Show currently active rules: netsh advfirewall monitor show firewall

- Adjusting Firewall Rules -

Enable a firewall rule: netsh advfirewall firewall set rule name="RuleName" new enable=yes
Disable a firewall rule: netsh advfirewall firewall set rule name="RuleName" new enable=no
Delete a firewall rule: netsh advfirewall firewall delete rule name="RuleName"
Block a specific port: netsh advfirewall firewall add rule name="BlockPort" dir=in action=block protocol=TCP localport=1234
Allow a specific port: netsh advfirewall firewall add rule name="AllowPort" dir=in action=allow protocol=TCP localport=1234
Block outbound traffic to IP: netsh advfirewall firewall add rule name="BlockOutboundIP" dir=out action=block remoteip=192.168.1.100
Allow inbound traffic from IP: netsh advfirewall firewall add rule name="AllowInboundIP" dir=in action=allow remoteip=192.168.1.100
Block traffic by program: netsh advfirewall firewall add rule name="BlockApp" dir=in action=block program="C:\App.exe"
Allow traffic by program: netsh advfirewall firewall add rule name="AllowApp" dir=in action=allow program="C:\App.exe"

- Firewall Profiles -

Show current profiles: netsh advfirewall show currentprofile
Disable a firewall profile: netsh advfirewall set currentprofile state off
Enable a firewall profile: netsh advfirewall set currentprofile state on
Disable all profiles: netsh advfirewall set allprofiles state off
Enable all profiles: netsh advfirewall set allprofiles state on

- Pentester-Focused Commands -

Search for Any "Allow All" Rules: netsh advfirewall firewall show rule name=all | findstr "Allow"
Check for Inbound Traffic Allowed on Common Ports: netsh advfirewall firewall show rule name=all | findstr "Port"
Review Exceptions to Firewall Rules: netsh advfirewall firewall show allowedprograms

Export firewall rules: netsh advfirewall export "C:\FirewallConfig.wfw"
Import firewall rules: netsh advfirewall import "C:\FirewallConfig.wfw"

Netsh Command: https://ss64.com/nt/netsh.html 


-- Event Logs --

What are Event Logs?
Event Logs are logs collected through the Windows operating system. There are various types of logs in these logs. Application logs, security logs and system logs can be given as examples. Event logs are a very important resource to understand whether many processes on the system have taken place and to have a grasp of the details. SOC analysts often make use of event logs when detecting the presence and activity of threats on the system. For example, some event logs are as follows:

• Powershell activities
• Deleting event logs
• Starting and stopping services
• Creating a new scheduled task
• RDP activity
• Changing user privileges
• Failed login activities

- Event Logs Structure -

The event logs are also in large numbers. All these records are kept in a certain order. Each record type has an "Event ID" value to distinguish it from each other. During the log analysis, filtering can be done according to the "Event ID" value in order to work with fewer logs and to work on a simpler output.
In Windows systems, there are three main event log titles as "Application", "System" and "Security". 

Application
It provides log records related to the applications in the system. For example, you can find errors received by an antivirus application running on the system.

System
It is the area where the logs created by the basic components of the operating system are located. For example, logs for a driver loads and unloads operations can be found here.

Security
Records regarding authentication and security are kept here. 

Viewing Event Logs with Event Viewer:(Windows + R) + eventvwr
Viewing Event Logs via Command Line: wevtutil

Examine the event logs with the Event ID value of "4625": wevtutil query-events Security /rd:true /count:1 /format:text /q:"Event[System[(EventID=4625)]]" 

• "query-events" parameter : Query events from a log or log file.
• "/rd" parameter : Reverse direction.
• "/count" parameter : Log count.
• "/format" parameter : Output format.
• "/q" parameter : XPathQuery.

- Extracting Event Logs -

List available event logs: wevtutil el
Query events from a specific log: wevtutil qe "LogName" /f:text /c:10
Filter events by time: wevtutil qe "LogName" /q:"*[System[TimeCreated[@SystemTime > '2024-12-01T00:00:00.000Z']]]"
Export events to a file: wevtutil epl "LogName" "C:\Logs\logname.evtx"
Read exported event logs: wevtutil qe "C:\Logs\logname.evtx" /f:text
Display events with IDs: wevtutil qe "LogName" /q:"*[System[(EventID=4624)]]" /f:text
Extract only error events: wevtutil qe "LogName" /q:"*[System[Level=2]]" /f:text

- Analyzing Critical Event Logs for Pentesting -

Check user logons: wevtutil qe Security /q:"*[System[(EventID=4624)]]" /f:text
Detect failed logons: wevtutil qe Security /q:"*[System[(EventID=4625)]]" /f:text
Find privilege escalation events: wevtutil qe Security /q:"*[System[(EventID=4673)]]" /f:text
Search for cleared logs: wevtutil qe Security /q:"*[System[(EventID=1102)]]" /f:text
Review account lockouts: wevtutil qe Security /q:"*[System[(EventID=4740)]]" /f:text
Investigate service installations: wevtutil qe System /q:"*[System[(EventID=7045)]]" /f:text
Track scheduled task changes: wevtutil qe Security /q:"*[System[(EventID=4698)]]" /f:text
Monitor PowerShell execution: wevtutil qe "Microsoft-Windows-PowerShell/Operational" /f:text
Review RDP connections: wevtutil qe Security /q:"*[System[(EventID=4624) and EventData[Data[@Name='LogonType']='10']]]"

- Modifying Event Logs -

Clear a specific event log: wevtutil cl "LogName"
Backup and clear a log: wevtutil epl "LogName" "C:\Logs\backup.evtx" && wevtutil cl "LogName"
Disable event logging: wevtutil sl "LogName" /e:false
Enable event logging: wevtutil sl "LogName" /e:true
Set log size limit: wevtutil sl "LogName" /ms:1048576

- Combining Commands -

Identify logon events with a specific username: wevtutil qe Security /q:"*[EventData[Data[@Name='TargetUserName']='victim']]" /f:text 
Monitor PowerShell script usage: wevtutil qe "Microsoft-Windows-PowerShell/Operational" /q:"*[System[(Level=1 or Level=2)]]" /f:text
Filter failed logons in a time range: wevtutil qe Security /q:"*[System[(EventID=4625) and TimeCreated[@SystemTime >= '2024-12-01T00:00:00.000Z']]]" /f:text


- Critical Event IDs for Pentesters -

4624	Security	Successful logon.
4625	Security	Failed logon attempt.
4673	Security	Privilege escalation attempt.
4674	Security	Sensitive privilege use (e.g., SeDebugPrivilege).
4698	Security	Scheduled task creation.
1102	Security	Audit log cleared.
5156	Security	Allowed connection through the Windows Filtering Platform.
4740	Security	Account lockout.
7045	System	  New service installation.
4104	PowerShell/Operational	PowerShell script block logging (useful for detecting malicious scripts).

Event ID List: https://andreafortuna.org/2019/06/12/windows-security-event-logs-my-own-cheatsheet/ 
Wevtutil: https://ss64.com/nt/wevtutil.html 


-- Windows Management Instrumentation (WMI) --














Windows Security Event Logs: my own cheatsheet

Windows 2000/XP and Windows Server 2003

512 - Windows NT is starting up
513 - Windows is shutting down
514 - An authentication package has been loaded by the Local Security Authority
515 - A trusted logon process has registered with the Local Security Authority
516 - Internal resources allocated for the queuing of audit messages have been exhausted, leading to the loss of some audits
517 - The audit log was cleared
518 - A notification package has been loaded by the Security Account Manager
519 - A process is using an invalid local procedure call (LPC) port
520 - The system time was changed
521 - Unable to log events to security log
528 - Successful Logon
529 - Logon Failure - Unknown user name or bad password
530 - Logon Failure - Account logon time restriction violation
531 - Logon Failure - Account currently disabled
532 - Logon Failure - The specified user account has expired
533 - Logon Failure - User not allowed to logon at this computer
534 - Logon Failure - The user has not been granted the requested logon type at this machine
535 - Logon Failure - The specified account's password has expired
536 - Logon Failure - The NetLogon component is not active
537 - Logon failure - The logon attempt failed for other reasons.
538 - User Logoff
539 - Logon Failure - Account locked out
540 - Successful Network Logon
551 - User initiated logoff
552 - Logon attempt using explicit credentials
560 - Object Open
561 - Handle Allocated
562 - Handle Closed
563 - Object Open for Delete
564 - Object Deleted
565 - Object Open (Active Directory)
566 - Object Operation (Active Directory)
567 - Object Access Attempt
576 - Special privileges assigned to new logon
577 - Privileged Service Called
578 - Privileged object operation
592 - A new process has been created
593 - A process has exited
594 - A handle to an object has been duplicated
595 - Indirect access to an object has been obtained
596 - Backup of data protection master key
600 - A process was assigned a primary token
601 - Attempt to install service
602 - Scheduled Task created
608 - User Right Assigned
609 - User Right Removed
610 - New Trusted Domain
611 - Removing Trusted Domain
612 - Audit Policy Change
613 - IPSec policy agent started
614 - IPSec policy agent disabled
615 - IPSEC PolicyAgent Service
616 - IPSec policy agent encountered a potentially serious failure.
617 - Kerberos Policy Changed
618 - Encrypted Data Recovery Policy Changed
619 - Quality of Service Policy Changed
620 - Trusted Domain Information Modified
621 - System Security Access Granted
622 - System Security Access Removed
623 - Per User Audit Policy was refreshed
624 - User Account Created
625 - User Account Type Changed
626 - User Account Enabled
627 - Change Password Attempt
628 - User Account password set
629 - User Account Disabled
630 - User Account Deleted
631 - Security Enabled Global Group Created
632 - Security Enabled Global Group Member Added
633 - Security Enabled Global Group Member Removed
634 - Security Enabled Global Group Deleted
635 - Security Enabled Local Group Created
636 - Security Enabled Local Group Member Added
637 - Security Enabled Local Group Member Removed
638 - Security Enabled Local Group Deleted
639 - Security Enabled Local Group Changed
640 - General Account Database Change
641 - Security Enabled Global Group Changed
642 - User Account Changed
643 - Domain Policy Changed
644 - User Account Locked Out
645 - Computer Account Created
646 - Computer Account Changed
647 - Computer Account Deleted
648 - Security Disabled Local Group Created
649 - Security Disabled Local Group Changed
650 - Security Disabled Local Group Member Added
651 - Security Disabled Local Group Member Removed
652 - Security Disabled Local Group Deleted
653 - Security Disabled Global Group Created
654 - Security Disabled Global Group Changed
655 - Security Disabled Global Group Member Added
656 - Security Disabled Global Group Member Removed
657 - Security Disabled Global Group Deleted
658 - Security Enabled Universal Group Created
659 - Security Enabled Universal Group Changed
660 - Security Enabled Universal Group Member Added
661 - Security Enabled Universal Group Member Removed
662 - Security Enabled Universal Group Deleted
663 - Security Disabled Universal Group Created
664 - Security Disabled Universal Group Changed
665 - Security Disabled Universal Group Member Added
666 - Security Disabled Universal Group Member Removed
667 - Security Disabled Universal Group Deleted
668 - Group Type Changed
669 - Add SID History
670 - Add SID History
671 - User Account Unlocked
672 - Authentication Ticket Granted
673 - Service Ticket Granted
674 - Ticket Granted Renewed
675 - Pre-authentication failed
676 - Authentication Ticket Request Failed
677 - Service Ticket Request Failed
678 - Account Mapped for Logon by
679 - The name: %2 could not be mapped for logon by: %1
680 - Account Used for Logon by
681 - The logon to account: %2 by: %1 from workstation: %3 failed.
682 - Session reconnected to winstation
683 - Session disconnected from winstation
684 - Set ACLs of members in administrators groups
685 - Account Name Changed
686 - Password of the following user accessed
687 - Basic Application Group Created
688 - Basic Application Group Changed
689 - Basic Application Group Member Added
690 - Basic Application Group Member Removed
691 - Basic Application Group Non-Member Added
692 - Basic Application Group Non-Member Removed
693 - Basic Application Group Deleted
694 - LDAP Query Group Created
695 - LDAP Query Group Changed
696 - LDAP Query Group Deleted
697 - Password Policy Checking API is called
806 - Per User Audit Policy was refreshed
807 - Per user auditing policy set for user
808 - A security event source has attempted to register
809 - A security event source has attempted to unregister
848 - The following policy was active when the Windows Firewall started
849 - An application was listed as an exception when the Windows Firewall started
850 - A port was listed as an exception when the Windows Firewall started
851 - A change has been made to the Windows Firewall application exception list
852 - A change has been made to the Windows Firewall port exception list
853 - The Windows Firewall operational mode has changed
854 - The Windows Firewall logging settings have changed
855 - A Windows Firewall ICMP setting has changed
856 - The Windows Firewall setting to allow unicast responses to multicast/broadcast traffic has changed
857 - The Windows Firewall setting to allow remote administration, allowing port TCP 135 and DCOM/RPC, has changed
858 - Windows Firewall group policy settings have been applied
859 - The Windows Firewall group policy settings have been removed
860 - The Windows Firewall has switched the active policy profile
861 - The Windows Firewall has detected an application listening for incoming traffic

Windows 7/Vista/8/10, Windows Server 2008/2012R2/2016/2019

1100 - The event logging service has shut down
1101 - Audit events have been dropped by the transport.
1102 - The audit log was cleared
1104 - The security Log is now full
1105 - Event log automatic backup
1108 - The event logging service encountered an error
4608 - Windows is starting up
4609 - Windows is shutting down
4610 - An authentication package has been loaded by the Local Security Authority
4611 - A trusted logon process has been registered with the Local Security Authority
4612 - Internal resources allocated for the queuing of audit messages have been exhausted, leading to the loss of some audits.
4614 - A notification package has been loaded by the Security Account Manager.
4615 - Invalid use of LPC port
4616 - The system time was changed.
4618 - A monitored security event pattern has occurred
4621 - Administrator recovered system from CrashOnAuditFail
4622 - A security package has been loaded by the Local Security Authority.
4624 - An account was successfully logged on
4625 - An account failed to log on
4626 - User/Device claims information
4627 - Group membership information.
4634 - An account was logged off
4646 - IKE DoS-prevention mode started
4647 - User initiated logoff
4648 - A logon was attempted using explicit credentials
4649 - A replay attack was detected
4650 - An IPsec Main Mode security association was established
4651 - An IPsec Main Mode security association was established
4652 - An IPsec Main Mode negotiation failed
4653 - An IPsec Main Mode negotiation failed
4654 - An IPsec Quick Mode negotiation failed
4655 - An IPsec Main Mode security association ended
4656 - A handle to an object was requested
4657 - A registry value was modified
4658 - The handle to an object was closed
4659 - A handle to an object was requested with intent to delete
4660 - An object was deleted
4661 - A handle to an object was requested
4662 - An operation was performed on an object
4663 - An attempt was made to access an object
4664 - An attempt was made to create a hard link
4665 - An attempt was made to create an application client context.
4666 - An application attempted an operation
4667 - An application client context was deleted
4668 - An application was initialized
4670 - Permissions on an object were changed
4671 - An application attempted to access a blocked ordinal through the TBS
4672 - Special privileges assigned to new logon
4673 - A privileged service was called
4674 - An operation was attempted on a privileged object
4675 - SIDs were filtered
4688 - A new process has been created
4689 - A process has exited
4690 - An attempt was made to duplicate a handle to an object
4691 - Indirect access to an object was requested
4692 - Backup of data protection master key was attempted
4693 - Recovery of data protection master key was attempted
4694 - Protection of auditable protected data was attempted
4695 - Unprotection of auditable protected data was attempted
4696 - A primary token was assigned to process
4697 - A service was installed in the system
4698 - A scheduled task was created
4699 - A scheduled task was deleted
4700 - A scheduled task was enabled
4701 - A scheduled task was disabled
4702 - A scheduled task was updated
4703 - A token right was adjusted
4704 - A user right was assigned
4705 - A user right was removed
4706 - A new trust was created to a domain
4707 - A trust to a domain was removed
4709 - IPsec Services was started
4710 - IPsec Services was disabled
4711 - PAStore Engine (1%)
4712 - IPsec Services encountered a potentially serious failure
4713 - Kerberos policy was changed
4714 - Encrypted data recovery policy was changed
4715 - The audit policy (SACL) on an object was changed
4716 - Trusted domain information was modified
4717 - System security access was granted to an account
4718 - System security access was removed from an account
4719 - System audit policy was changed
4720 - A user account was created
4722 - A user account was enabled
4723 - An attempt was made to change an account's password
4724 - An attempt was made to reset an accounts password
4725 - A user account was disabled
4726 - A user account was deleted
4727 - A security-enabled global group was created
4728 - A member was added to a security-enabled global group
4729 - A member was removed from a security-enabled global group
4730 - A security-enabled global group was deleted
4731 - A security-enabled local group was created
4732 - A member was added to a security-enabled local group
4733 - A member was removed from a security-enabled local group
4734 - A security-enabled local group was deleted
4735 - A security-enabled local group was changed
4737 - A security-enabled global group was changed
4738 - A user account was changed
4739 - Domain Policy was changed
4740 - A user account was locked out
4741 - A computer account was created
4742 - A computer account was changed
4743 - A computer account was deleted
4744 - A security-disabled local group was created
4745 - A security-disabled local group was changed
4746 - A member was added to a security-disabled local group
4747 - A member was removed from a security-disabled local group
4748 - A security-disabled local group was deleted
4749 - A security-disabled global group was created
4750 - A security-disabled global group was changed
4751 - A member was added to a security-disabled global group
4752 - A member was removed from a security-disabled global group
4753 - A security-disabled global group was deleted
4754 - A security-enabled universal group was created
4755 - A security-enabled universal group was changed
4756 - A member was added to a security-enabled universal group
4757 - A member was removed from a security-enabled universal group
4758 - A security-enabled universal group was deleted
4759 - A security-disabled universal group was created
4760 - A security-disabled universal group was changed
4761 - A member was added to a security-disabled universal group
4762 - A member was removed from a security-disabled universal group
4763 - A security-disabled universal group was deleted
4764 - A groups type was changed
4765 - SID History was added to an account
4766 - An attempt to add SID History to an account failed
4767 - A user account was unlocked
4768 - A Kerberos authentication ticket (TGT) was requested
4769 - A Kerberos service ticket was requested
4770 - A Kerberos service ticket was renewed
4771 - Kerberos pre-authentication failed
4772 - A Kerberos authentication ticket request failed
4773 - A Kerberos service ticket request failed
4774 - An account was mapped for logon
4775 - An account could not be mapped for logon
4776 - The domain controller attempted to validate the credentials for an account
4777 - The domain controller failed to validate the credentials for an account
4778 - A session was reconnected to a Window Station
4779 - A session was disconnected from a Window Station
4780 - The ACL was set on accounts which are members of administrators groups
4781 - The name of an account was changed
4782 - The password hash an account was accessed
4783 - A basic application group was created
4784 - A basic application group was changed
4785 - A member was added to a basic application group
4786 - A member was removed from a basic application group
4787 - A non-member was added to a basic application group
4788 - A non-member was removed from a basic application group..
4789 - A basic application group was deleted
4790 - An LDAP query group was created
4791 - A basic application group was changed
4792 - An LDAP query group was deleted
4793 - The Password Policy Checking API was called
4794 - An attempt was made to set the Directory Services Restore Mode administrator password
4797 - An attempt was made to query the existence of a blank password for an account
4798 - A user's local group membership was enumerated.
4799 - A security-enabled local group membership was enumerated
4800 - The workstation was locked
4801 - The workstation was unlocked
4802 - The screen saver was invoked
4803 - The screen saver was dismissed
4816 - RPC detected an integrity violation while decrypting an incoming message
4817 - Auditing settings on object were changed.
4818 - Proposed Central Access Policy does not grant the same access permissions as the current Central Access Policy
4819 - Central Access Policies on the machine have been changed
4820 - A Kerberos Ticket-granting-ticket (TGT) was denied because the device does not meet the access control restrictions
4821 - A Kerberos service ticket was denied because the user, device, or both does not meet the access control restrictions
4822 - NTLM authentication failed because the account was a member of the Protected User group
4823 - NTLM authentication failed because access control restrictions are required
4824 - Kerberos preauthentication by using DES or RC4 failed because the account was a member of the Protected User group
4825 - A user was denied the access to Remote Desktop. By default, users are allowed to connect only if they are members of the Remote Desktop Users group or Administrators group
4826 - Boot Configuration Data loaded
4830 - SID History was removed from an account
4864 - A namespace collision was detected
4865 - A trusted forest information entry was added
4866 - A trusted forest information entry was removed
4867 - A trusted forest information entry was modified
4868 - The certificate manager denied a pending certificate request
4869 - Certificate Services received a resubmitted certificate request
4870 - Certificate Services revoked a certificate
4871 - Certificate Services received a request to publish the certificate revocation list (CRL)
4872 - Certificate Services published the certificate revocation list (CRL)
4873 - A certificate request extension changed
4874 - One or more certificate request attributes changed.
4875 - Certificate Services received a request to shut down
4876 - Certificate Services backup started
4877 - Certificate Services backup completed
4878 - Certificate Services restore started
4879 - Certificate Services restore completed
4880 - Certificate Services started
4881 - Certificate Services stopped
4882 - The security permissions for Certificate Services changed
4883 - Certificate Services retrieved an archived key
4884 - Certificate Services imported a certificate into its database
4885 - The audit filter for Certificate Services changed
4886 - Certificate Services received a certificate request
4887 - Certificate Services approved a certificate request and issued a certificate
4888 - Certificate Services denied a certificate request
4889 - Certificate Services set the status of a certificate request to pending
4890 - The certificate manager settings for Certificate Services changed.
4891 - A configuration entry changed in Certificate Services
4892 - A property of Certificate Services changed
4893 - Certificate Services archived a key
4894 - Certificate Services imported and archived a key
4895 - Certificate Services published the CA certificate to Active Directory Domain Services
4896 - One or more rows have been deleted from the certificate database
4897 - Role separation enabled
4898 - Certificate Services loaded a template
4899 - A Certificate Services template was updated
4900 - Certificate Services template security was updated
4902 - The Per-user audit policy table was created
4904 - An attempt was made to register a security event source
4905 - An attempt was made to unregister a security event source
4906 - The CrashOnAuditFail value has changed
4907 - Auditing settings on object were changed
4908 - Special Groups Logon table modified
4909 - The local policy settings for the TBS were changed
4910 - The group policy settings for the TBS were changed
4911 - Resource attributes of the object were changed
4912 - Per User Audit Policy was changed
4913 - Central Access Policy on the object was changed
4928 - An Active Directory replica source naming context was established
4929 - An Active Directory replica source naming context was removed
4930 - An Active Directory replica source naming context was modified
4931 - An Active Directory replica destination naming context was modified
4932 - Synchronization of a replica of an Active Directory naming context has begun
4933 - Synchronization of a replica of an Active Directory naming context has ended
4934 - Attributes of an Active Directory object were replicated
4935 - Replication failure begins
4936 - Replication failure ends
4937 - A lingering object was removed from a replica
4944 - The following policy was active when the Windows Firewall started
4945 - A rule was listed when the Windows Firewall started
4946 - A change has been made to Windows Firewall exception list. A rule was added
4947 - A change has been made to Windows Firewall exception list. A rule was modified
4948 - A change has been made to Windows Firewall exception list. A rule was deleted
4949 - Windows Firewall settings were restored to the default values
4950 - A Windows Firewall setting has changed
4951 - A rule has been ignored because its major version number was not recognized by Windows Firewall
4952 - Parts of a rule have been ignored because its minor version number was not recognized by Windows Firewall
4953 - A rule has been ignored by Windows Firewall because it could not parse the rule
4954 - Windows Firewall Group Policy settings has changed. The new settings have been applied
4956 - Windows Firewall has changed the active profile
4957 - Windows Firewall did not apply the following rule
4958 - Windows Firewall did not apply the following rule because the rule referred to items not configured on this computer
4960 - IPsec dropped an inbound packet that failed an integrity check
4961 - IPsec dropped an inbound packet that failed a replay check
4962 - IPsec dropped an inbound packet that failed a replay check
4963 - IPsec dropped an inbound clear text packet that should have been secured
4964 - Special groups have been assigned to a new logon
4965 - IPsec received a packet from a remote computer with an incorrect Security Parameter Index (SPI).
4976 - During Main Mode negotiation, IPsec received an invalid negotiation packet.
4977 - During Quick Mode negotiation, IPsec received an invalid negotiation packet.
4978 - During Extended Mode negotiation, IPsec received an invalid negotiation packet.
4979 - IPsec Main Mode and Extended Mode security associations were established.
4980 - IPsec Main Mode and Extended Mode security associations were established
4981 - IPsec Main Mode and Extended Mode security associations were established
4982 - IPsec Main Mode and Extended Mode security associations were established
4983 - An IPsec Extended Mode negotiation failed
4984 - An IPsec Extended Mode negotiation failed
4985 - The state of a transaction has changed
5024 - The Windows Firewall Service has started successfully
5025 - The Windows Firewall Service has been stopped
5027 - The Windows Firewall Service was unable to retrieve the security policy from the local storage
5028 - The Windows Firewall Service was unable to parse the new security policy.
5029 - The Windows Firewall Service failed to initialize the driver
5030 - The Windows Firewall Service failed to start
5031 - The Windows Firewall Service blocked an application from accepting incoming connections on the network.
5032 - Windows Firewall was unable to notify the user that it blocked an application from accepting incoming connections on the network
5033 - The Windows Firewall Driver has started successfully
5034 - The Windows Firewall Driver has been stopped
5035 - The Windows Firewall Driver failed to start
5037 - The Windows Firewall Driver detected critical runtime error. Terminating
5038 - Code integrity determined that the image hash of a file is not valid
5039 - A registry key was virtualized.
5040 - A change has been made to IPsec settings. An Authentication Set was added.
5041 - A change has been made to IPsec settings. An Authentication Set was modified
5042 - A change has been made to IPsec settings. An Authentication Set was deleted
5043 - A change has been made to IPsec settings. A Connection Security Rule was added
5044 - A change has been made to IPsec settings. A Connection Security Rule was modified
5045 - A change has been made to IPsec settings. A Connection Security Rule was deleted
5046 - A change has been made to IPsec settings. A Crypto Set was added
5047 - A change has been made to IPsec settings. A Crypto Set was modified
5048 - A change has been made to IPsec settings. A Crypto Set was deleted
5049 - An IPsec Security Association was deleted
5050 - An attempt to programmatically disable the Windows Firewall using a call to INetFwProfile.FirewallEnabled(FALSE
5051 - A file was virtualized
5056 - A cryptographic self test was performed
5057 - A cryptographic primitive operation failed
5058 - Key file operation
5059 - Key migration operation
5060 - Verification operation failed
5061 - Cryptographic operation
5062 - A kernel-mode cryptographic self test was performed
5063 - A cryptographic provider operation was attempted
5064 - A cryptographic context operation was attempted
5065 - A cryptographic context modification was attempted
5066 - A cryptographic function operation was attempted
5067 - A cryptographic function modification was attempted
5068 - A cryptographic function provider operation was attempted
5069 - A cryptographic function property operation was attempted
5070 - A cryptographic function property operation was attempted
5071 - Key access denied by Microsoft key distribution service
5120 - OCSP Responder Service Started
5121 - OCSP Responder Service Stopped
5122 - A Configuration entry changed in the OCSP Responder Service
5123 - A configuration entry changed in the OCSP Responder Service
5124 - A security setting was updated on OCSP Responder Service
5125 - A request was submitted to OCSP Responder Service
5126 - Signing Certificate was automatically updated by the OCSP Responder Service
5127 - The OCSP Revocation Provider successfully updated the revocation information
5136 - A directory service object was modified
5137 - A directory service object was created
5138 - A directory service object was undeleted
5139 - A directory service object was moved
5140 - A network share object was accessed
5141 - A directory service object was deleted
5142 - A network share object was added.
5143 - A network share object was modified
5144 - A network share object was deleted.
5145 - A network share object was checked to see whether client can be granted desired access
5146 - The Windows Filtering Platform has blocked a packet
5147 - A more restrictive Windows Filtering Platform filter has blocked a packet
5148 - The Windows Filtering Platform has detected a DoS attack and entered a defensive mode
5149 - The DoS attack has subsided and normal processing is being resumed.
5150 - The Windows Filtering Platform has blocked a packet.
5151 - A more restrictive Windows Filtering Platform filter has blocked a packet.
5152 - The Windows Filtering Platform blocked a packet
5153 - A more restrictive Windows Filtering Platform filter has blocked a packet
5154 - The Windows Filtering Platform has permitted an application or service to listen on a port for incoming connections
5155 - The Windows Filtering Platform has blocked an application or service from listening on a port for incoming connections
5156 - The Windows Filtering Platform has allowed a connection
5157 - The Windows Filtering Platform has blocked a connection
5158 - The Windows Filtering Platform has permitted a bind to a local port
5159 - The Windows Filtering Platform has blocked a bind to a local port
5168 - Spn check for SMB/SMB2 fails.
5169 - A directory service object was modified
5170 - A directory service object was modified during a background cleanup task
5376 - Credential Manager credentials were backed up
5377 - Credential Manager credentials were restored from a backup
5378 - The requested credentials delegation was disallowed by policy
5379 - Credential Manager credentials were read
5380 - Vault Find Credential
5381 - Vault credentials were read
5382 - Vault credentials were read
5440 - The following callout was present when the Windows Filtering Platform Base Filtering Engine started
5441 - The following filter was present when the Windows Filtering Platform Base Filtering Engine started
5442 - The following provider was present when the Windows Filtering Platform Base Filtering Engine started
5443 - The following provider context was present when the Windows Filtering Platform Base Filtering Engine started
5444 - The following sub-layer was present when the Windows Filtering Platform Base Filtering Engine started
5446 - A Windows Filtering Platform callout has been changed
5447 - A Windows Filtering Platform filter has been changed
5448 - A Windows Filtering Platform provider has been changed
5449 - A Windows Filtering Platform provider context has been changed
5450 - A Windows Filtering Platform sub-layer has been changed
5451 - An IPsec Quick Mode security association was established
5452 - An IPsec Quick Mode security association ended
5453 - An IPsec negotiation with a remote computer failed because the IKE and AuthIP IPsec Keying Modules (IKEEXT) service is not started
5456 - PAStore Engine applied Active Directory storage IPsec policy on the computer
5457 - PAStore Engine failed to apply Active Directory storage IPsec policy on the computer
5458 - PAStore Engine applied locally cached copy of Active Directory storage IPsec policy on the computer
5459 - PAStore Engine failed to apply locally cached copy of Active Directory storage IPsec policy on the computer
5460 - PAStore Engine applied local registry storage IPsec policy on the computer
5461 - PAStore Engine failed to apply local registry storage IPsec policy on the computer
5462 - PAStore Engine failed to apply some rules of the active IPsec policy on the computer
5463 - PAStore Engine polled for changes to the active IPsec policy and detected no changes
5464 - PAStore Engine polled for changes to the active IPsec policy, detected changes, and applied them to IPsec Services
5465 - PAStore Engine received a control for forced reloading of IPsec policy and processed the control successfully
5466 - PAStore Engine polled for changes to the Active Directory IPsec policy, determined that Active Directory cannot be reached, and will use the cached copy of the Active Directory IPsec policy instead
5467 - PAStore Engine polled for changes to the Active Directory IPsec policy, determined that Active Directory can be reached, and found no changes to the policy
5468 - PAStore Engine polled for changes to the Active Directory IPsec policy, determined that Active Directory can be reached, found changes to the policy, and applied those changes
5471 - PAStore Engine loaded local storage IPsec policy on the computer
5472 - PAStore Engine failed to load local storage IPsec policy on the computer
5473 - PAStore Engine loaded directory storage IPsec policy on the computer
5474 - PAStore Engine failed to load directory storage IPsec policy on the computer
5477 - PAStore Engine failed to add quick mode filter
5478 - IPsec Services has started successfully
5479 - IPsec Services has been shut down successfully
5480 - IPsec Services failed to get the complete list of network interfaces on the computer
5483 - IPsec Services failed to initialize RPC server. IPsec Services could not be started
5484 - IPsec Services has experienced a critical failure and has been shut down
5485 - IPsec Services failed to process some IPsec filters on a plug-and-play event for network interfaces
5632 - A request was made to authenticate to a wireless network
5633 - A request was made to authenticate to a wired network
5712 - A Remote Procedure Call (RPC) was attempted
5888 - An object in the COM+ Catalog was modified
5889 - An object was deleted from the COM+ Catalog
5890 - An object was added to the COM+ Catalog
6144 - Security policy in the group policy objects has been applied successfully
6145 - One or more errors occured while processing security policy in the group policy objects
6272 - Network Policy Server granted access to a user
6273 - Network Policy Server denied access to a user
6274 - Network Policy Server discarded the request for a user
6275 - Network Policy Server discarded the accounting request for a user
6276 - Network Policy Server quarantined a user
6277 - Network Policy Server granted access to a user but put it on probation because the host did not meet the defined health policy
6278 - Network Policy Server granted full access to a user because the host met the defined health policy
6279 - Network Policy Server locked the user account due to repeated failed authentication attempts
6280 - Network Policy Server unlocked the user account
6281 - Code Integrity determined that the page hashes of an image file are not valid...
6400 - BranchCache: Received an incorrectly formatted response while discovering availability of content.
6401 - BranchCache: Received invalid data from a peer. Data discarded.
6402 - BranchCache: The message to the hosted cache offering it data is incorrectly formatted.
6403 - BranchCache: The hosted cache sent an incorrectly formatted response to the client's message to offer it data.
6404 - BranchCache: Hosted cache could not be authenticated using the provisioned SSL certificate.
6405 - BranchCache: %2 instance(s) of event id %1 occurred.
6406 - %1 registered to Windows Firewall to control filtering for the following:
6407 - %1
6408 - Registered product %1 failed and Windows Firewall is now controlling the filtering for %2.
6409 - BranchCache: A service connection point object could not be parsed
6410 - Code integrity determined that a file does not meet the security requirements to load into a process. This could be due to the use of shared sections or other issues
6416 - A new external device was recognized by the system.
6417 - The FIPS mode crypto selftests succeeded
6418 - The FIPS mode crypto selftests failed
6419 - A request was made to disable a device
6420 - A device was disabled
6421 - A request was made to enable a device
6422 - A device was enabled
6423 - The installation of this device is forbidden by system policy
6424 - The installation of this device was allowed, after having previously been forbidden by policy
8191 - Highest System-Defined Audit Message Value

