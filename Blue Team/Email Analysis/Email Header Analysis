
An Email Header is a hidden section containing detailed information about the email's origin, routing, and delivery, accessible through email client settings.
The header contains several fields, each providing specific pieces of information. Here are the key components of an email header:

• From: The email address and optionally the name of the sender.
• To: The recipient's email address.
• Subject: The subject line of the email.
• Date: The date and time the email was sent.
• Return-Path: The email address that should receive bounce messages if the email can't be delivered.
• Received: Information about the servers that handled the email as it traveled from the sender to the recipient. Each server adds its own "Received" line, making it possible to trace the email's path.
• Message-ID: A unique identifier for the email, generated by the sending server.
• Content-Type: Specifies the format of the email (e.g., text/plain, text/html, multipart).
• MIME-Version: Indicates the version of the MIME protocol used.
• DKIM-Signature: Digital signature added by the sending server to verify the email's authenticity and integrity.
• SPF: Sender Policy Framework record, used to verify that the email was sent from an authorized server (Check the Received-SPF or the Authentication-Results header).
• DMARC: Domain-based Message Authentication, Reporting, and Conformance policy that uses SPF and DKIM to determine the legitimacy of an email.
• ARC-Seal, ARC-Message-Signature, ARC-Authentication-Results: Authenticated Received Chain (ARC) headers used to verify email authentication and preserve results across trusted intermediaries.
• X-Spam Status: The X-Spam Status shows you the spam score of an email message.



-- Using dig for SPF Verification --

dig (Domain Information Groper) is a command-line tool used for querying DNS (Domain Name System) servers. 

$ dig @8.8.8.8 -t txt example.com
$ dig @8.8.8.8 -t txt spf.protection.outlook.com
$ dig txt futurepipe.com | grep "v=spf1"



-- Extract Data --

sudo apt cache search lha
sudo apt install lhasa

cat file1.bin | base64 -d | xxd | less
cat file1.bin | base64 -d > file1.lzh
lhasa file1.lzh
ls














-- Bounced Emails --

Receiving bounced emails, also known as "bounce-back emails" or "Non-Delivery Reports" (NDRs), happens when an email you send cannot be delivered to the recipient. These emails are returned to you with a message explaining why the delivery failed. There are two types of bounces:

1. Soft Bounce: This is a temporary issue. The email reaches the recipient's server but is rejected due to reasons such as:
   - The recipient's mailbox is full.
   - The server is down or busy.
   - The email message is too large for the recipient's inbox.

2. Hard Bounce This is a permanent issue, where the email cannot be delivered because:
   - The recipient's email address is invalid or no longer exists.
   - The domain of the recipient’s email address doesn’t exist.

The bounce-back message usually contains a reason for the failure, which helps identify the cause. If you are receiving these emails, it means that messages you sent could not be delivered to their intended recipients.



-- SPF (Sender Policy Framework --

SPF (Sender Policy Framework) is an email authentication method that helps verify whether a mail server is authorized to send emails on behalf of a domain. During email header analysis, the **SPF check** involves validating the sender's IP address against the domain's SPF record to prevent email spoofing and phishing attacks.

When analyzing an email header, the SPF check works as follows:

1. DNS Lookup The receiving mail server performs a DNS query to check the SPF record of the domain found in the "MAIL FROM" field (the envelope sender address). The SPF record lists the IP addresses or domains authorized to send emails for that domain.

2. Sender IP Validation The mail server compares the sender's IP address (the IP address from which the email was sent) to the list of authorized IP addresses in the domain's SPF record.

3. SPF Result The mail server then returns one of several SPF results in the email header:
   - Pass: The sender’s IP address is authorized to send email for the domain.
   - Fail: The sender’s IP address is not authorized to send email for the domain, indicating potential email spoofing.
   - SoftFail: The sender’s IP address is not authorized, but the policy allows delivery with a warning.
   - Neutral: No clear pass or fail, usually when the domain owner does not define an SPF policy.
   - None: No SPF record found for the domain.

### Example of SPF Check in an Email Header:

Received-SPF: Pass (mail.protection.outlook.com: domain of example.com designates 192.168.1.1 as permitted sender) receiver=protection.outlook.com; client-ip=192.168.1.1; helo=mail.example.com;

- Pass: Indicates that the sender’s IP address is authorized according to the SPF record.
- domain of example.com: The domain being checked (from the "MAIL FROM" field).
- client-ip=192.168.1.1: The IP address of the sender.
- helo=mail.example.com: The server that claimed to send the email.

In summary, the SPF check helps detect whether an email's source is legitimate by cross-referencing the sending IP with the domain's published SPF records. This validation is included in the email header as part of anti-spam and anti-phishing efforts.



-- DKIM --




-- DMARC --




-- X-Header --

An X-Header is a custom header field in an email that provides additional information about the message, its routing, or how it was processed.

- Purpose of X-Headers -

- Tracking: X-Headers can be used to track the progress of an email through various systems, providing details about the servers or security tools that processed the message.
- Filtering: Security systems may add X-Headers to indicate whether an email passed or failed spam or malware checks.
- Custom Information: Organizations or services may include X-Headers for internal purposes, such as identifying campaigns or specific users.
- Debugging: X-Headers can help system administrators diagnose delivery issues or security problems.


- Common X-Headers for Email Analysis -

X-Spam-Flag:
Indicates whether the email was flagged as spam.
Example: X-Spam-Flag: YES

X-Spam-Status:
Provides detailed information on the spam evaluation of the email, including the spam score and required threshold.
Example: X-Spam-Status: No, score=-2.6 required=5.0

X-Spam-Score:
The numerical score representing the spam level of the email.
Example: X-Spam-Score: 4.2

X-Spam-Level:
A visual indicator of the spam score, typically represented with asterisks or other symbols.
Example: X-Spam-Level: ****

X-Originating-IP:
Reveals the original IP address from which the email was sent.
Example: X-Originating-IP: [192.168.1.10]

X-Received:
Lists additional information about intermediate mail servers involved in routing the email.
Example: X-Received: by 2002:a05:612c:fd0:b0:46b:1f60:44ff with SMTP

X-Mailer:
Specifies the email client or software used to send the message.
Example: X-Mailer: Microsoft Outlook 16.0

X-Authentication-Results:
Shows the results of authentication checks like SPF, DKIM, or DMARC.
Example: X-Authentication-Results: dkim=pass; spf=pass

X-Priority:
Indicates the priority or urgency of the email as set by the sender.
Example: X-Priority: 1 (Highest)

X-MSMail-Priority:
Microsoft-specific header indicating the message priority.
Example: X-MSMail-Priority: High

X-Sender:
Contains the sender’s email address or domain name.
Example: X-Sender: john@example.com

X-Forwarded-For:
Indicates the original IP address when the email has been forwarded.
Example: X-Forwarded-For: 192.168.1.5

X-MailFrom:
Specifies the original sender’s email address or the bounce address.
Example: X-MailFrom: bounce@example.com

X-SES-Outgoing:
Used by Amazon SES to indicate the outgoing server details.
Example: X-SES-Outgoing: 2024.05.12-54.240.60.143

X-MimeOLE:
Specifies which version of Microsoft’s MIME encoder was used to compose the message.
Example: X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

X-Content-Filtered-By:
Shows what content filtering or security tools processed the email.
Example: X-Content-Filtered-By: Barracuda Email Security Service

X-DKIM-Signature:
Indicates the DKIM signature for verifying the integrity and origin of the email.
Example: X-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=example.com; s=default

X-Virus-Scanned:
Confirms whether the email was scanned for viruses and what antivirus service was used.
Example: X-Virus-Scanned: by ClamAV

X-Dropbox-Message-ID:
A unique identifier for tracking messages sent via Dropbox's email system.
Example: X-Dropbox-Message-ID: 15848236649165401982

X-CID (X-cid):
A custom header added by the sender to track messages for internal or campaign purposes, sometimes used for unique identifiers.
Example: X-CID: 8337

X-ClientProxiedBy:
Indicates that the email client was proxied by another server or service, providing information about the intermediary server.
Example: X-ClientProxiedBy: SMTP2.example.com via SMTP3.proxy.com


These X-Headers are useful for tracking the origin and journey of an email, identifying security risks, and understanding how emails were processed and delivered through various services.




-- Links --

E-Mail Header Analyzer (MHA)
https://github.com/cyberdefenders/email-header-analyzer

Analyze Email Headers to understand routing, identify issues, and detect potential spam or malicious emails
https://mha.azurewebsites.net/

GitHub Repositorie that contain collections of spam and phishing emails
https://github.com/rf-peixoto/phishing_pot
