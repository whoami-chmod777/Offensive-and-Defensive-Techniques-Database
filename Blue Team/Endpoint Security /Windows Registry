
In Security Operations Center (SOC) analysis, the Windows Registry is a crucial forensic artifact. It stores configuration settings, user activity data, and system state information ‚Äî making it a goldmine for identifying malicious behavior, persistence mechanisms, and lateral movement.
Here‚Äôs a breakdown of important Windows Registry hives, their functionality paths, and key areas SOC analysts should monitor:


--- Windows Registry ---

‚Ä¢ HKEY_LOCAL_MACHINE (HKLM)
‚Ä¢ HKEY_CURRENT_USER (HKCU)
‚Ä¢ HKEY_USERS (HKU)
‚Ä¢ HKEY_CLASSES_ROOT (HKCR)
‚Ä¢ HKEY_CURRENT_CONFIG (HKCC)
‚Ä¢ High-Value Registry Keys for SOC Analysis
‚Ä¢ Tips for SOC Analysts


--- Built-in Windows Registry CLI ---

‚Ä¢ The Built-in Windows Registry CLI Tool
‚Ä¢ Common Use Cases for SOC/Forensics Work


--- Useful Registry Value Types (/t parameter) ---


-- Windows Registry --

üîë 1. HKEY_LOCAL_MACHINE (HKLM)

‚Ä¢ Path: HKLM\
‚Ä¢ Purpose: Contains configuration data for the entire system, hardware, drivers, services, and installed software.

‚Ä¢ Important Subkeys:
  ‚Üí HKLM\SYSTEM\CurrentControlSet\Services\
    ‚ñ∫ What to look for: Malicious drivers, unauthorized services.
    ‚ñ∫ Why: Attackers may create or modify services for persistence.
  ‚Üí HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
    ‚ñ∫ What to look for: Auto-start entries.
    ‚ñ∫ Why: Used for persistence by malware.
  ‚Üí HKLM\SAM
    ‚ñ∫ What to look for: Windows account credentials (protected).
    ‚ñ∫ Why: Accessed during credential dumping attacks (e.g., Mimikatz).
  ‚Üí HKLM\SECURITY
    ‚ñ∫ What to look for: LSA secrets, cached credentials.
    ‚ñ∫ Why: Targeted in credential attacks.


üßç 2. HKEY_CURRENT_USER (HKCU)

‚Ä¢ Path: HKCU\
‚Ä¢ Purpose: Settings specific to the currently logged-in user.

‚Ä¢ Important Subkeys:
  ‚Üí HKCU\Software\Microsoft\Windows\CurrentVersion\Run
    ‚ñ∫ What to look for: User-specific persistence.
  ‚Üí HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs
    ‚ñ∫ What to look for: Recent file access ‚Äî useful in timeline analysis.
  ‚Üí HKCU\Software\Microsoft\Windows\Shell\BagMRU
    ‚ñ∫ What to look for: User interaction with folders.
  ‚Üí HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU
    ‚ñ∫ What to look for: Files recently accessed via open/save dialogs.


üåê 3. HKEY_USERS (HKU)

‚Ä¢ Path: HKU\<UserSID>\
‚Ä¢ Purpose: Contains user profile settings for all users.
‚Ä¢ Useful for: Accessing another user‚Äôs HKCU equivalent when they are not logged in.

‚Ä¢ Important Subkeys:

‚Üí Look for same keys as in HKCU, but under each SID (e.g., S-1-5-21-...).


‚öôÔ∏è 4. HKEY_CLASSES_ROOT (HKCR)

‚Ä¢ Path: HKCR\
‚Ä¢ Purpose: File association and COM object settings.

‚Ä¢ Important Subkeys:
  ‚Üí Used in DLL hijacking or COM hijacking.
  ‚Üí Malware may register malicious DLLs here for persistence.


üñ•Ô∏è 5. HKEY_CURRENT_CONFIG (HKCC)

‚Ä¢ Path: HKCC\
‚Ä¢ Purpose: Dynamic configuration data ‚Äî hardware profile used at startup.
‚Ä¢ Less relevant for persistence or IOC detection, but helpful for understanding device context.


üîç High-Value Registry Keys for SOC Analysis

HKLM\SYSTEM\CurrentControlSet\Services\ ‚Üí Service definitions ‚Üí Check for new/modified services
HKLM\Software\Microsoft\Windows\CurrentVersion\Run ‚Üí System-wide autoruns ‚Üí Malware persistence
HKCU\Software\Microsoft\Windows\CurrentVersion\Run ‚Üí User-specific autoruns ‚Üí User-level persistence
HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs ‚Üí Recently opened documents ‚Üí User activity
HKCU\Software\Microsoft\Windows\Shell\BagMRU ‚Üí Folder access history ‚Üí Lateral movement / behavior
HKCU\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers ‚Üí Application compatibility shims ‚Üí Exploit abuse
HKLM\SYSTEM\CurrentControlSet\Control\Lsa ‚Üí Security policies ‚Üí Credential dumping (e.g., disabling LSASS protection)


üéØ Tips for SOC Analysts

‚Ä¢ Use tools like:
  ‚Üí RegRipper, Autoruns, Sysinternals, FTK Imager, Velociraptor, KAPE.

‚Ä¢ Correlate registry findings with:
  ‚Üí Event logs (EVTX)
  ‚Üí File system artifacts ($MFT, prefetch, shimcache)
  ‚Üí Memory analysis

‚Ä¢ Watch for anomalies like:
  ‚Üí Suspicious Run keys pointing to non-standard paths
  ‚Üí Services with strange names or binaries in C:\Users\ or AppData
  ‚Üí Unexpected registry changes outside patch windows



‚úÖ reg.exe ‚Äì The Built-in Windows Registry CLI Tool

It allows you to add, delete, query, import/export, and compare registry entries from the command line.

reg [add|delete|query|copy|save|load|unload|restore|compare|export|import] <KeyName> [Options]


1. üîç Query a Registry Key
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
Use case: Check for persistence mechanisms. Add /s to recursively list all subkeys:
reg query "HKCU\Software\Microsoft" /s

2. ‚ûï Add a Registry Key or Value
reg add "HKCU\Software\TestKey" /v "MaliciousRun" /t REG_SZ /d "C:\Evil\malware.exe" /f
/v: value name
/t: type (e.g., REG_SZ, REG_DWORD, etc.)
/d: data
/f: force overwrite without prompt

3. ‚ùå Delete a Registry Key or Value
reg delete "HKCU\Software\TestKey" /f
To delete just a value:
reg delete "HKCU\Software\TestKey" /v "MaliciousRun" /f

4. üìù Export a Registry Key to File
reg export "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" C:\runkey_backup.reg

5. üì• Import a Registry File
reg import C:\runkey_backup.reg

6. üîÑ Compare Two Registry Keys
reg compare "HKCU\Software\Microsoft" "HKLM\Software\Microsoft"


üí° Useful Registry Value Types (/t parameter)

REG_SZ ‚Üí String
REG_DWORD ‚Üí 32-bit integer
REG_BINARY ‚Üí Binary data
REG_MULTI_SZ ‚Üí Multi-line strings
REG_EXPAND_SZ ‚Üí Expandable string


üîê Requires Admin?

‚Ä¢ HKCU = No admin needed
‚Ä¢ HKLM, HKCR, HKU = Usually requires admin


üö® Security Tip

From a SOC perspective, also monitor use of reg.exe by suspicious processes:

reg query HKLM\SAM
reg save HKLM\SAM C:\sam.save


************************************************************************************************************************

‚Ä¢ Structure of the Registry
‚Ä¢ Accessing Registry hive Offline
‚Ä¢ Important Registry Keys
‚Ä¢ 
‚Ä¢ 
‚Ä¢ 
‚Ä¢ 


--- Structure of the Registry ---

‚Ä¢ The Windows Registry is a collection of databases that contains the system's configuration data. This configuration data can be about the hardware, the software, or the user's information. It also includes data about the recently used files, programs used, or devices connected to the system. As you can understand, this data is beneficial from a forensics standpoint.
‚Ä¢ You can view the registry using regedit.exe, a built-in Windows utility to view and edit the registry.
‚Ä¢ The Windows registry consists of Keys and Values.
  ‚Üí When you open the regedit.exe utility to view the registry, the folders you see are Registry Keys.
  ‚Üí Registry Values are the data stored in these Registry Keys.
‚Ä¢ A Registry Hiveis a group of Keys, subkeys, and values stored in a single file on the disk.

The registry on any Windows system contains the following five root keys:

‚Ä¢ HKEY_CURRENT_USER
‚Ä¢ HKEY_USERS
‚Ä¢ HKEY_LOCAL_MACHINE
‚Ä¢ HKEY_CLASSES_ROOT
‚Ä¢ HKEY_CURRENT_CONFIG


--- Accessing Registry hive Offline ---

‚Ä¢ Most of these hives are in the C:\Windows\System32\Config directory and are:

1. DEFAULT (mounted on HKEY_USERS\DEFAULT)
2. SAM (mounted on HKEY_LOCAL_MACHINE\SAM)
3. SECURITY (mounted on HKEY_LOCAL_MACHINE\Security)
4. SOFTWARE (mounted on HKEY_LOCAL_MACHINE\Software)
5. SYSTEM (mounted on HKEY_LOCAL_MACHINE\System)

‚Ä¢ Hives containing user information:
  ‚Üí Apart from these hives, two other hives containing user information can be found in the User profile directory. For Windows 7 and above, a user‚Äôs profile directory is in C:\Users\<username>\ where the hives are:
‚Ä¢ NTUSER.DAT (mounted on HKEY_CURRENT_USER when a user logs in)
‚Ä¢ The NTUSER.DAT hive is in the directory C:\Users\<username>\
‚Ä¢ USRCLASS.DAT (mounted on HKEY_CURRENT_USER\Software\CLASSES)
‚Ä¢ The USRCLASS.DAT hive is in the directory C:\Users\<username>\AppData\Local\Microsoft\Windows.

‚Ä¢AmCache hive is in C:\Windows\AppCompat\Programs\Amcache.hve. Windows creates this hive to save information on programs that were recently run on the system.


--- Important Registry Keys (System Information) ---

‚Ä¢ OS Version: SOFTWARE\Microsoft\Windows NT\CurrentVersion
‚Ä¢ Current Control set:
  ‚Üí HKLM\SYSTEM\CurrentControlSet
  ‚Üí SYSTEM\Select\Current
  ‚Üí SYSTEM\Select\LastKnownGood
‚Ä¢ Computer Name:
  ‚Üí SYSTEM\CurrentControlSet\Control\ComputerName
‚Ä¢ Time Zone Information:
  ‚Üí SYSTEM\CurrentControlSet\Control\TimeZoneInformation
‚Ä¢ Network Interfaces and Past Networks:
  ‚Üí SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces
‚Ä¢ Autostart Programs (Autoruns):
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce
  ‚Üí SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
  ‚Üí SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run
  ‚Üí SOFTWARE\Microsoft\Windows\CurrentVersion\Run
  ‚Üí SAM hive and user information:
‚Ä¢ SAM\Domains\Account\User
  ‚Üí SAM\Domains\Account\User

--- Important Registry Keys (External Device) ---

‚Ä¢ Device identification:
  ‚Üí SYSTEM\CurrentControlSet\Enum\USBSTOR
  ‚Üí SYSTEM\CurrentControlSet\Enum\USB
‚Ä¢ First/Last Times:
  ‚Üí SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USBSerial#\Properties\{83da6326-97a6-4088-9453-a19231573b29}\####
  ‚Üí Oo64=first connection
  ‚Üí 0066=last connection
  ‚Üí 0067=last removal
‚Ä¢ USB device Volume Name:
  ‚Üí SOFTWARE\Microsoft\Windows Portable Devices\Devices
‚Ä¢ HKLM\SYSTEM\MountedDevices
  ‚Üí Find Serial # to obtain the Drive Letter of the USB device
  ‚Üí Find Serial # to obtain the Volume GUID of the USB device


--- Important Registry Keys (File/folder usage) ---

‚Ä¢ Recent Files:
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs
‚Ä¢ Office Recent Files:
  ‚Üí NTUSER.DAT\Software\Microsoft\Office\VERSION
  ‚Üí NTUSER.DAT\Software\Microsoft\Office\VERSION\UserMRU\LiveID_####\FileMRU
‚Ä¢ ShellBags:
  ‚Üí USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags 
  ‚Üí USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags
‚Ä¢ Open/Save and LastVisited Dialog MRUs:
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePIDlMRU
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU
‚Ä¢ Windows Explorer Address/Search Bars:
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths
  ‚Üí NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuer


--- Important Registry Keys (Network Behaviour) ---

‚Ä¢ HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList
  ‚Üí \Signatures
    ‚ñ∫ \Unmanaged (record DefaultGatewayMac, DnsSuffix, FirstNetwork (SSID), ProfileGuid)
    ‚ñ∫ \Managed
  ‚Üí \Nla
    ‚ñ∫ \Cache
  ‚Üí Profiles
‚Ä¢ Most info regarding NLA will be stored under the NetworkList key above, and also:
  ‚Üí HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\HomeGroup
‚Ä¢ HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles\{GUID}
  ‚Üí Network Types:
    ‚ñ∫ 0x06 = Wired
    ‚ñ∫ 0x17 = Broadband
    ‚ñ∫ 0x47 = Wireless
  ‚Üí Category:
    ‚ñ∫ 0 ‚Äì Public
    ‚ñ∫ 1 ‚Äì Private
    ‚ñ∫ 2 - Domain/Work


--- Auditing Registry Through PowerShell ---

‚Ä¢ Get-ChildItem -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\'
‚Ä¢ Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\‚Äô
‚Ä¢ Get-ItemPropertyValue -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\' -name SecurityHealth
‚Ä¢ Get-ChildItem -Path 'HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR‚Äô
‚Ä¢ Get-ChildItem -Path 'HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR\Disk&Ven_SanDisk&Prod_Cruzer_Blade&Rev_1.00‚Äô


--- Malware Persistence in Registry ---

‚Ä¢ HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run and RunOnce
‚Ä¢ HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run and RunOnce
‚Ä¢ HKEY_CLASSES_ROOT\Directory\Background\Shell ‚Äì Launches while running any shell or on mouse click option
‚Ä¢ HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects - BHOs can modify browser behavior, inject advertisements, or steal sensitive information.
‚Ä¢ HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services ‚Äì Create as a service themselves
‚Ä¢ HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServices - Malware may add entries here to run as a service during user login
‚Ä¢ HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows and add as AppInit_DLLs
‚Ä¢ HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify ‚Äì Launches itself when windows kernel event occurs, such as user login, user logoff
‚Ä¢ HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\SharedTaskScheduler - Malware may add entries under this key to run code when the Windows Explorer starts.
‚Ä¢ HKEY_CURRENT_USER\Control Panel\Desktop\SCRNSAVE.EXE - Malware can modify this value to set a screensaver executable that contains malicious code.









