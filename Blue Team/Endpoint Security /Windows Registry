
In Security Operations Center (SOC) analysis, the Windows Registry is a crucial forensic artifact. It stores configuration settings, user activity data, and system state information â€” making it a goldmine for identifying malicious behavior, persistence mechanisms, and lateral movement.
Hereâ€™s a breakdown of important Windows Registry hives, their functionality paths, and key areas SOC analysts should monitor:


--- Windows Registry ---

â€¢ HKEY_LOCAL_MACHINE (HKLM)
â€¢ HKEY_CURRENT_USER (HKCU)
â€¢ HKEY_USERS (HKU)
â€¢ HKEY_CLASSES_ROOT (HKCR)
â€¢ HKEY_CURRENT_CONFIG (HKCC)
â€¢ High-Value Registry Keys for SOC Analysis
â€¢ Tips for SOC Analysts


--- Built-in Windows Registry CLI ---

â€¢ The Built-in Windows Registry CLI Tool
â€¢ Common Use Cases for SOC/Forensics Work


--- Useful Registry Value Types (/t parameter) ---


-- Windows Registry --

ğŸ”‘ 1. HKEY_LOCAL_MACHINE (HKLM)

â€¢ Path: HKLM\
â€¢ Purpose: Contains configuration data for the entire system, hardware, drivers, services, and installed software.

â€¢ Important Subkeys:
  â†’ HKLM\SYSTEM\CurrentControlSet\Services\
    â–º What to look for: Malicious drivers, unauthorized services.
    â–º Why: Attackers may create or modify services for persistence.
  â†’ HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
    â–º What to look for: Auto-start entries.
    â–º Why: Used for persistence by malware.
  â†’ HKLM\SAM
    â–º What to look for: Windows account credentials (protected).
    â–º Why: Accessed during credential dumping attacks (e.g., Mimikatz).
  â†’ HKLM\SECURITY
    â–º What to look for: LSA secrets, cached credentials.
    â–º Why: Targeted in credential attacks.


ğŸ§ 2. HKEY_CURRENT_USER (HKCU)

â€¢ Path: HKCU\
â€¢ Purpose: Settings specific to the currently logged-in user.

â€¢ Important Subkeys:
  â†’ HKCU\Software\Microsoft\Windows\CurrentVersion\Run
    â–º What to look for: User-specific persistence.
  â†’ HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs
    â–º What to look for: Recent file access â€” useful in timeline analysis.
  â†’ HKCU\Software\Microsoft\Windows\Shell\BagMRU
    â–º What to look for: User interaction with folders.
  â†’ HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU
    â–º What to look for: Files recently accessed via open/save dialogs.


ğŸŒ 3. HKEY_USERS (HKU)

â€¢ Path: HKU\<UserSID>\
â€¢ Purpose: Contains user profile settings for all users.
â€¢ Useful for: Accessing another userâ€™s HKCU equivalent when they are not logged in.

â€¢ Important Subkeys:

â†’ Look for same keys as in HKCU, but under each SID (e.g., S-1-5-21-...).


âš™ï¸ 4. HKEY_CLASSES_ROOT (HKCR)

â€¢ Path: HKCR\
â€¢ Purpose: File association and COM object settings.

â€¢ Important Subkeys:
  â†’ Used in DLL hijacking or COM hijacking.
  â†’ Malware may register malicious DLLs here for persistence.


ğŸ–¥ï¸ 5. HKEY_CURRENT_CONFIG (HKCC)

â€¢ Path: HKCC\
â€¢ Purpose: Dynamic configuration data â€” hardware profile used at startup.
â€¢ Less relevant for persistence or IOC detection, but helpful for understanding device context.


ğŸ” High-Value Registry Keys for SOC Analysis

HKLM\SYSTEM\CurrentControlSet\Services\ â†’ Service definitions â†’ Check for new/modified services
HKLM\Software\Microsoft\Windows\CurrentVersion\Run â†’ System-wide autoruns â†’ Malware persistence
HKCU\Software\Microsoft\Windows\CurrentVersion\Run â†’ User-specific autoruns â†’ User-level persistence
HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs â†’ Recently opened documents â†’ User activity
HKCU\Software\Microsoft\Windows\Shell\BagMRU â†’ Folder access history â†’ Lateral movement / behavior
HKCU\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers â†’ Application compatibility shims â†’ Exploit abuse
HKLM\SYSTEM\CurrentControlSet\Control\Lsa â†’ Security policies â†’ Credential dumping (e.g., disabling LSASS protection)


ğŸ¯ Tips for SOC Analysts

â€¢ Use tools like:
  â†’ RegRipper, Autoruns, Sysinternals, FTK Imager, Velociraptor, KAPE.

â€¢ Correlate registry findings with:
  â†’ Event logs (EVTX)
  â†’ File system artifacts ($MFT, prefetch, shimcache)
  â†’ Memory analysis

â€¢ Watch for anomalies like:
  â†’ Suspicious Run keys pointing to non-standard paths
  â†’ Services with strange names or binaries in C:\Users\ or AppData
  â†’ Unexpected registry changes outside patch windows



âœ… reg.exe â€“ The Built-in Windows Registry CLI Tool

It allows you to add, delete, query, import/export, and compare registry entries from the command line.

reg [add|delete|query|copy|save|load|unload|restore|compare|export|import] <KeyName> [Options]


1. ğŸ” Query a Registry Key
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
Use case: Check for persistence mechanisms. Add /s to recursively list all subkeys:
reg query "HKCU\Software\Microsoft" /s

2. â• Add a Registry Key or Value
reg add "HKCU\Software\TestKey" /v "MaliciousRun" /t REG_SZ /d "C:\Evil\malware.exe" /f
/v: value name
/t: type (e.g., REG_SZ, REG_DWORD, etc.)
/d: data
/f: force overwrite without prompt

3. âŒ Delete a Registry Key or Value
reg delete "HKCU\Software\TestKey" /f
To delete just a value:
reg delete "HKCU\Software\TestKey" /v "MaliciousRun" /f

4. ğŸ“ Export a Registry Key to File
reg export "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" C:\runkey_backup.reg

5. ğŸ“¥ Import a Registry File
reg import C:\runkey_backup.reg

6. ğŸ”„ Compare Two Registry Keys
reg compare "HKCU\Software\Microsoft" "HKLM\Software\Microsoft"


ğŸ’¡ Useful Registry Value Types (/t parameter)

REG_SZ â†’ String
REG_DWORD â†’ 32-bit integer
REG_BINARY â†’ Binary data
REG_MULTI_SZ â†’ Multi-line strings
REG_EXPAND_SZ â†’ Expandable string


ğŸ” Requires Admin?

â€¢ HKCU = No admin needed
â€¢ HKLM, HKCR, HKU = Usually requires admin


ğŸš¨ Security Tip

From a SOC perspective, also monitor use of reg.exe by suspicious processes:

reg query HKLM\SAM
reg save HKLM\SAM C:\sam.save










