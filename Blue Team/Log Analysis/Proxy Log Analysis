
--- Proxy Log Analysis ---

• Proxy Log Analysis
• A sample Proxy Log
• Review the Proxy Log
• Suspicious Activities
• Logs Examples


-- Proxy Log Analysis --

The Proxy basically acts as a bridge between the endpoint and the internet. Organizations generally use proxy technology for purposes such as internet speed, centralized control and increasing the level of security. Requests made by the client reach the Proxy Server first and then the Internet. Proxies can basically work in 2 different types:

Transparent Proxy: Target server that we access can see the real source IP address.
Anonymous Proxy: Target server that we access cannot see the real source IP address. It sees the IP address of the proxy as the source IP address. Thus, it cannot obtain any information about the system that actually made the request in the background.

   +---------+             +----------------+             +-----------+
   |  Client |  Request →  |  Proxy Server  |  Request →  |  Internet |
   | (User)  |  ← Reply    | (Cache/Filter) |  ← Reply    |  (Web)    |
   +---------+             +----------------+             +-----------+


The proxy working structure controls the access of systems (server, client, etc.) to services such as HTTP, HTTPS, FTP according to the determined policies and operates the actions taken according to the policies as block or pass actions.
It basically queries the URL/domain to be accessed from the category database, and if the category is a risky category, a block action is applied, otherwise a pass action is applied. Since some systems do not need to reach any networks other than some certain ones, an implicit deny may be applied to all networks other than the ones that are needed to be accessed.


-- A sample Proxy Log --

date=2022-05-21 time=16:15:44 type="utm" subtype="webfilter" eventtype="urlfilter" level="warning" srcip=192.168.209.142 srcport=34280 srcintfrole="lan" dstip=54.20.21.189 dstport=443 dstintfrole="wan" service="HTTPS" hostname="android.prod.cloud.netflix.com" profile="Wifi-Guest" action="blocked" url="https://android.prod.cloud.netflix.com/" sentbyte=517 rcvdbyte=0 direction="outgoing" urlsource="Local URLfilter Block" msg="URL was blocked because it is in the URL filter list"


-- Review the Proxy Log --

• date= date information

time= time information

type= log type

subtype= log sub type (values like forward, vpn, webfilter, virus, ips, system etc.)

eventtype= event type that belongs to the sub type

level= incident severity level

srcip= source IP address

srcport= source port information

srcinfrole= source interface information

dstip= destination IP address

dstport= destination port information

dstinfrole= destination interface information

service= service information

hostname= requested domain

profile= source profile

action= action information

url= URL address requested

sentbyte = size of data sent by bytes

rcvdbyte= size of data received by bytes

direction= direction of the traffic

urlsource= URL sources

• msg= message information


Proxy logs are one of the most important log types when a SOC analyst needs to check which domain/URL a system (server, client, etc.) is making a request to our internal systems and whether it was able to establish a successful connection.


-- Suspicious Activities --

We can detect following suspicious activities through reviewing the proxy logs:
• Connections to/from suspicious URLs
• Infected system detection
• Detection of tunneling activities


-- Proxy Logs Examples --

Jun 17 10:47:00 10.10.18.11 CEF:0|Forcepoint|Security|8.5.4|194|Transaction blocked|7| act=blocked app=https dvc=10.10.18.11 dst=104.26.11.18 dhost=sentry-proxy.cargox.cc dpt=443 src=10.80.18.50 spt=61603 suser=Test_User requestMethod=POST requestClientApplication=Mozilla/5.0 (Windows NT 10.0; Win64; x64) cs1Label=Policy cs1=Block_Risk_Category_Policy(Servers) request=https://sentry-proxy.cargox.cc/api/3/envelope/?sentry_key\=e2506000e29247eba06eee9df3f011e0&sentry_version\=7 

Mar 30 19:07:16 10.60.28.21 CEF:0|Forcepoint|Security|8.5.4|1900|Transaction permitted|164| act=permitted app=https dst=18.11.96.7 dhost=letsdefend.io dpt=443 src=172.20.40.42 spt=59228 suser=user1 requestMethod=CONNECT cs1Label=Policy cs1=default-user-policy request=https://letsdefend.io/ 























