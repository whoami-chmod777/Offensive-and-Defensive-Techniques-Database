
--- Introduction to Malware Analysis ---

• Malware Definition and Malware Types
• Malware Types
• What Should a Malware Analyst Know
• Which Approach Should You Choose When Analyzing Malware (Static Analysis / Dynamic Analysis)
• 


-- Malware Definition and Malware Types --

The word Malware is a word derived from the words MALicious softWARE. It is the name given to software that endangers the security and integrity of systems by targeting a malicious purpose.

Today, cyber threat actors use malicious software to achieve various purposes such as ensuring persistence, damaging systems, demanding ransom. As SOC analyst, we need to analyze suspicious software and understand whether the software is really harmful.

Since there is no restriction, you can come across malicious software written in almost all programming languages. You don't need to know all programming languages ​​to start analyzing malware. However, we can say that being familiar with programming makes it easy to analyze malicious software (it is even mandatory in matters such as reverse engineering).

With each passing day, we see that cyber threat actors develop themselves and develop more complex malware. Attackers now use various methods to make analysis of their malicious software even more difficult. 

In this process, we must constantly improve ourselves in order to be prepared for current threats.

As a SOC analyst, you will encounter many suspicious files in your daily work routine. These files may have come via email, or may have been detected by the antivirus software on the user device, or they may have been detected by the network security products while being transferred. I believe you got the point :)

As a result of the analysis, you will be able to find whether the file is harmful or not; and its purpose if it is harmful, the command and control servers and the type of the malware.


-- Malware Types --

Although the names of the command and control servers and the methods they use vary, the purposes of malicious software are within certain categories. In this way, you can inform the other person about what the malware is doing by simply telling the category of the malware.

For example, if you say that the software you are examining is a keylogger, everyone will know that this is a software that records and plays the keys pressed on the keyboard. You may provide this important initial information about the malware to your upper management to give the idea about it and the attacker's target then follow up with the detailed analysis report.

As we mentioned, malicious software are divided into types according to their functions/purposes/characters. After analyzing the malware, you will match it with one of the following types. Therefore, you should know what these types are.

Some types of malware and their descriptions are as follows.

• Backdoor: Leaving a backdoor on the device where the malware is installed, it allows the attacker to access the system through this backdoor. For example, by opening a network port connected to the shell, it enables the attacker to connect to the system through this port.
• Adware: It often comes with downloaded software, causing unwanted advertisements to be displayed on the device. While not all adware is harmful, some change the default search engine.
• Ransomware: It is a type of malware that has been on the world agenda for the last few years. It demands ransom from people by encrypting and exfiltrating all files on the device.
• Virus: It is one of the first types of malware seen in the wild. So we see that in daily life, it is often called a virus instead of the term malware. Viruses have a self-replicate feature. It provides persistence by infecting other files on the device.
• Worm: Since this type of malware spreads from infected devices to other devices, it is named worm. WannaCry, a worm malware exploiting MS17-010 vulnerability, caused panic around the world.
• Rootkit: It is a type of malware that disguises itself by providing access to a high level of authority on the device.
• RAT (Remote Access Trojan): It is a type of malware that provides full control over the device to the threat actor.
• Banking malware: A type of malware that targets banking applications and causes money to be stolen from the victim.
• Keylogger: A type of malware that logs pushed keys and sends this information to attacker.

A malware may contain more than one feature, so a malware can belong to more than one type. For example, WannaCry malware includes both worm and ransomware malware features.


-- What Should a Malware Analyst Know --

Malware analysis is a subject that may seem easy from the outside, but in essence, it requires expertise in many aspects. While malware analysis is a separate field in its own right, some Tier 3 SOC Analysts (Subject Matter Experts) focus their careers in malware analysis only. Although malware analysis is a separate field, it is often used by Security Analysts in their daily work routines.
In order to be able to analyze malicious software correctly and successfully, it is necessary to have the basics in many subjects. Let's take a look at these topics.

- Operating System Fundamentals and Architecture -

Since malware runs on operating systems, malware analysts should have a solid understanding and knowledge of the operating systems.
Malware often takes advantage of the features offered by the operating system, increasing its privileges, making discovery and ensuring persistence. To give an example on Windows operating systems, malicious software uses the features of the operating system such as Task Scheduler, Services, Registry to ensure persistence.
In addition to the features of the operating system, API, Syscalls, Memory Architecture and lower level issues are also important for successful malware analysis. We will focus on these topics more on the "Static Malware Analysis" training.

- Assembly Language & Programming -

If you ever developed software before, have you wondered what happens when you compile the programming languages you write? Or have you ever wondered how the processors run multiple programming languages when there are many programming languages.
Processors only understand 0s and 1s. All data, except 0 and 1 are meaningless to the processors. When you compile any program in languages ​​such as, C/C++, Python, Java, Ruby, Go etc. compilers translate the codes you write into 0s and 1s that the processor can understand. When you start a program, these 0s and 1s are sent to the processor over the memory to run.

START
Preprocessor – hello_world.c
Compiler – hello_world.i
Assembler – hello_world.s
END
Executable – hello_world.exe

It shows the C program compilation process in four stages:

1. Preprocessor takes hello_world.c
2. Compiler outputs hello_world.i
3. Assembler produces hello_world.s
4. Executable generated as hello_world.exe

The lowest level programming language you can see is Assembly if we do not consider 0s and 1s. Each instruction has a direct 0 and 1 counterpart. When you compile a program written in C, it is first translated to Assembly language and then to 0s and 1s.
Compiled malware can be easily converted into the Assembly language. However, converting from Assembly language to the next level is not very easy and accurate, so analyses are usually made through Assembly language. Software that translates machine codes into Assembly language is called "Disassembler".
In the static code analysis training, we will also focus on the basics of the "Assembly" Language.

- Network Protocols and Fundamentals -

Malware often exhibits network activity in order to hijack information, connect to a command and control server, or download second payloads. Understanding these network traffics while analyzing malware is extremely important for us to understand the purpose of the malware.
For this reason, malware analysts should have basic network knowledge.

- Cryptography -

Many technologies make use of cryptography to provide security. It is also used by attackers for purposes such as complicating, preventing detection and preventing access.
Popular ransomware uses cryptography nowadays to encrypt files and prevent access to files without paying a ransom.
We often encounter cryptography during malware analysis.


-- Which Approach Should You Choose When Analyzing Malware --

If you work in the defensive field, analyzing malware becomes part of your job. I will show with which approaches you can analyze malware and the advantages / disadvantages of these approaches to each other.

There are 2 different approaches to analyzing malware.

1. Static Analysis
2. Dynamic Analysis

1. What is Static Analysis?

It is the approach of analyzing malicious software by reverse engineering methods without running them.
Generally, by decompile / disassemble the malware, each step that the malware will execute is analyzed, hence the behavior / capacity of the malware can be analyzed.
Your device will not be infected as you do not run malicious software in static analysis. (However, we do not recommend performing static analysis on your host device, it will be more proper to do your analysis in a virtual operating system.)

The information examined during the static analysis is as follows.

• P.E. (Portable Executable) Headers
• Imported DLL's
• Exported DLL's
• Strings in binary
• CPU Instructions

2. What is Dynamic Analysis?

It is the approach that examines the behavior of malicious software on the system by running it.
In dynamic analysis, applications that can examine registry, file, network and process events are installed in the system, and their behavior is examined by running malicious software.
While doing dynamic analysis, you should carefully examine the following events.

• Network Connections
• File Events
• Process Events
• Registry Events

Static Analysis vs Dynamic Analysis

Which approach to use when analyzing malware depends on the current circumstances. In cases where you want to get fast results, you can choose dynamic analysis, but we cannot say that the analysis is complete without doing both static and dynamic analysis.
It should also be noted that using only one approach may not be sufficient to analyze malware. Using both approaches together will lead you to victory!

Static Analysis
• Static analysis takes long time.
• You can learn the capacity of the malware.
• Detailed analysis result

Dynamic Analysis
• Dynamic analysis in general takes a short while.
• As a result of dynamic analysis, you can learn only the activities on the system on which it is run.
• Analysis result is not detailed

As a result, we cannot say that one approach is better than another. Each has an advantage over each other in different conditions.
If you work as a Level 1-2 SOC analyst, you can usually take action by quickly obtaining the address c2 with the help of dynamic analysis.









































