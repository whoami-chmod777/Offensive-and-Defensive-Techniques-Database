
--- Digital Forensics ---

‚Ä¢ The Digital Forensics Investigation Process  
‚Ä¢ Order of Volatility  
‚Ä¢ Chain of Custody  
‚Ä¢ FTK Imager  
‚Ä¢ Windows Forensic Artifacts  
‚Ä¢ LNK Files, Prefetch Files, and Jump Lists  
‚Ä¢ Windows Forensic Artifact Triage 


-- The Digital Forensics Investigation Process --


+----------------+    +----------------+    +----------------+    +----------------+    +----------------+    +----------------+    +----------------+ 
| Identification | -> |  Preservation  | -> |   Collection   | -> |  Examination   | -> |    Analysis    | -> |  Presentation  | -> |    Decision    |
+----------------+    +----------------+    +----------------+    +----------------+    +----------------+    +----------------+    +----------------+       


1. Identification

‚Ä¢ Confirm that an incident or crime has occurred
‚Ä¢ Sources: victim reports, detections, audits
‚Ä¢ Prepare to respond: locate and preserve evidence
‚Ä¢ Define scope and focus of the investigation

2. Preservation

‚Ä¢ Keep evidence intact and unaltered ("the system is a crime scene")
‚Ä¢ Capture a snapshot of the system‚Äôs current state
‚Ä¢ Identify relevant data (volatile / non-volatile)
‚Ä¢ Maintain chain of custody (who, what, when, where, why)
‚Ä¢ Secure physical and digital evidence

3. Collection

‚Ä¢ Gather all identified evidence (devices, peripherals)
‚Ä¢ Ensure legal authority (warrant, consent, scope)
‚Ä¢ Collect volatile data first
‚Ä¢ Reduce irrelevant data
‚Ä¢ Document and verify integrity

4. Examination

‚Ä¢ Inspect, analyze, and interpret evidence
‚Ä¢ Work with forensic images, not originals
‚Ä¢ Extract and translate raw data into readable form
‚Ä¢ Use a checklist for consistency
‚Ä¢ Discover hidden or deleted data

5. Analysis

‚Ä¢ Interpret the evidence: how does it support the hypothesis, how does it refute the hypothesis, what does it mean in context
‚Ä¢ Data context: don‚Äôt analyze in a vacuum.
‚Ä¢ Iteration: analyze, ask new questions, re-analyze.
‚Ä¢ Relational analysis: links between people, places, systems, and events.
‚Ä¢ Functional analysis: how system/operational configurations relate to the incident.
‚Ä¢ Temporal analysis: timelines, sequences of activity, and pattern analysis.


6. Presentation

‚Ä¢ Communicate the results: legal teams, executives, and decision makers.
‚Ä¢ Ensure clarity: findings should be understandable to both technical and non-technical audiences.
‚Ä¢ Guide the audience: let the evidence lead to logical conclusions; avoid speculation.
‚Ä¢ Executive summaries: highlight key results, significant findings, and clear explanations.
‚Ä¢ Comprehensive documentation: include tools used, evidence discovered, and reasoning behind relevance.
‚Ä¢ Reproducibility: another forensic analyst should be able to reach the same conclusion.

7. Decision

‚Ä¢ Evaluate the results: review all findings, conclusions, and documentation for completeness and accuracy.
‚Ä¢ Make a decision: determine if the evidence and conclusions are sufficient, decide whether additional investigation is needed.
‚Ä¢ Prosecution or remediation: support legal proceedings by building a case and providing expert testimony, implement corrective or preventive measures within the organization.



-- Order of Volatility --  

The Order of Volatility defines the sequence in which digital evidence should be collected

+---------------------------+    +------------------------------------+    +----------------------------+    +----------------------------+    +---------------------------+    +---------------------------+
|   CPU Registers and Cache | -> | RAM and Active Network Connections | -> | Temp Files and System Logs | -> |     Disk Storage Data      | -> |       Remote Logging      | -> |        Archive Media      |
+---------------------------+    +------------------------------------+    +----------------------------+    +----------------------------+    +---------------------------+    +---------------------------+

1. CPU Registers and Cache
‚Ä¢ Processor Registers: Very fast, temporary storage inside the CPU; holds current instructions, storage addresses, and active data.
‚Ä¢ Cache Memory: Stores and returns frequently used instructions and data to speed up processing.
‚Ä¢ Running Processes: Currently active programs, including paths, PIDs, and command-line invocations.

2. RAM and Active Network Connections
‚Ä¢ Random Access Memory (RAM): Short-lived data (session info, unsaved documents, process data).
‚Ä¢ Network Connections: Current TCP/UDP connections and open ports.
‚Ä¢ Routing Table: Lists pathways to network destinations.
‚Ä¢ ARP Cache: Maps IP addresses to MAC addresses.

3. Temp Files and System Logs
‚Ä¢ Temporary Files: Downloads or temp configurations stored in %TEMP%, C:\Windows\Temp, /tmp.
‚Ä¢ Swap Files: Temporary memory space on disk used by the OS.
‚Ä¢ System and Application Logs: Contain event records but can be overwritten or cleared.

4. Disk Storage Data
‚Ä¢ Hard Disk Drives (HDDs): Persistent system and user data.
‚Ä¢ Solid State Drives (SSDs): Faster but use TRIM/garbage collection, which can erase data.
‚Ä¢ System Configurations: OS components, installed software, user files, documents, executables, and backups.

5. Remote Logging
‚Ä¢ Endpoint Telemetry: Local logs (system, security, app, network, DNS, etc.).
‚Ä¢ Centralized Log Collection: Logs aggregated on SIEM servers or cloud storage; replicated and managed with rotation policies.

6. Archive Media
‚Ä¢ Long-term Storage: Backup tapes, optical disks (CDs/DVDs/Blu-rays), archival drives, or cloud archival storage.
‚Ä¢ Backups: Files and databases stored for recovery.
‚Ä¢ Security Controls: Ensure confidentiality, integrity, and availability of stored evidence.



-- Chain of Custody  --

Chain of Custody

The Chain of Custody (CoC) is the official process of documenting the handling of evidence ‚Äî from the moment it is collected until it is presented in court or stored.
It ensures that digital or physical evidence remains authentic, untampered, and legally admissible.

‚Ä¢ Tracking Evidence
  ‚Üí Records every step of evidence handling ‚Äî from collection to presentation.
  ‚Üí Ensures the same evidence is presented in court that was originally collected.
  ‚Üí Maintains accountability for each person involved.

‚Ä¢ Documenting Possession
  ‚Üí Identifies all parties who handled or accessed the evidence (law enforcement, stakeholders, investigators, examiners).
  ‚Üí Each time evidence changes hands, a Chain of Custody form must be filled out and signed.

‚Ä¢ Storage Conditions
  ‚Üí Logs date, time, reason, and sending/receiving parties for every evidence transfer.
  ‚Üí Describes where and how evidence is stored (e.g., temperature, physical or digital security).


Forensic Data Integrity

Forensic Data Integrity ensures that digital evidence remains complete, authentic, and unaltered from the time it is collected until the end of the investigation.
Maintaining integrity guarantees that the evidence is legally admissible and scientifically reliable.

Write Blockers
‚Ä¢ Preserve the integrity of storage devices.
‚Ä¢ Prevent any write commands that could alter original data.
‚Ä¢ Can be hardware or software-based.
‚Ä¢ All analysis should be performed on forensic images, not the original drive.

Evidence Bags
‚Ä¢ Contain and protect physical or digital evidence.
‚Ä¢ Tamper-resistant or tamper-evident for security.
‚Ä¢ Include labeling for case identification and documentation.

Legal Holds
‚Ä¢ Place a litigation hold to prevent deletion or modification of relevant data.
‚Ä¢ Preserve evidence until the case or investigation is fully resolved.

Documentation
‚Ä¢ Record all procedures, tools used, evidence conditions, and observations.
‚Ä¢ Provides transparency and reproducibility in the forensic process.



-- FTK Imager --  

FTK Imager is a forensic tool by AccessData used to create precise, unaltered copies of digital evidence for analysis. It verifies data integrity through hash comparison, ensuring the image matches the original evidence exactly.

üß∞ FTK Imager: Forensic Image Acquisition

‚Ä¢ Open FTK Imager. 
  ‚Üí Launch the program on your analysis workstation.
‚Ä¢ Click File > Create Disk Image. 
  ‚Üí This begins the acquisition wizard.
‚Ä¢ Select Evidence Type. 
  ‚Üí Choose Physical Drive, Logical Drive or Image File, then click Next.
‚Ä¢ Select the Source Drive. 
  ‚Üí Pick the evidence disk or partition and click Finish.
‚Ä¢ Click Add to set destination. 
  ‚Üí Choose the image type ‚Äî usually E01 (EnCase) or Raw (dd) ‚Äî and click Next.
‚Ä¢ Enter Case Details. 
  ‚Üí Fill in examiner name, case number, and description (optional), then click Next.
‚Ä¢ Choose Destination Folder and File Name. 
  ‚Üí Browse to a secure location and click Finish.
‚Ä¢ Enable Verification. 
  ‚Üí Tick Verify images after creation to perform automatic hash validation.
‚Ä¢ Click Start. 
  ‚Üí The acquisition process begins.
‚Ä¢ Review the Hash Report. 
  ‚Üí Confirm that the pre- and post-acquisition hash values match.


üíΩ Mounting Image To Drive

‚Ä¢ Open FTK Imager.
‚Ä¢ Click File > Image Mounting.
‚Ä¢ Browse and Select the Image File (.E01, .dd, etc.).
‚Ä¢ Choose Mounting Options: 
  ‚Üí Select Read-Only mode to preserve integrity.
  ‚Üí Choose a drive letter to assign.
‚Ä¢ Click Mount.
  ‚Üí The image appears as a virtual drive in Windows Explorer.
‚Ä¢ Access Files.
  ‚Üí You can now browse, open, or analyze contents without altering the original evidence.


üîê How to Extract Protected Files Using FTK Imager

‚Ä¢ Open the Image.
  ‚Üí Click File > Add Evidence Item and load the image file.
‚Ä¢ Navigate to Protected Files.
  ‚Üí Locate encrypted, restricted, or system-protected files in the directory tree.
‚Ä¢ Right-Click the File(s) ‚Üí Export Files.
  ‚Üí Choose a safe output folder for extraction.
‚Ä¢ Decrypt or Access Protected Content (if credentials or keys are available).
‚Ä¢ Verify Integrity.
  ‚Üí Compare hash values before and after extraction to confirm authenticity.


üß† FTK Imager: Memory Acquisition

‚Ä¢ Open FTK Imager.
‚Ä¢ Click File > Capture Memory.
‚Ä¢ Select Destination Path.
  ‚Üí Choose where to save the memory dump (e.g., C:\Evidence\RAMdump.mem).
‚Ä¢ Enable Pagefile Capture (optional).
  ‚Üí Include pagefile.sys for extended memory content.
‚Ä¢ Click Capture Memory.
  ‚Üí The tool creates a .mem file of the system‚Äôs RAM.
‚Ä¢ Verify the Hash.
  ‚Üí Review the hash report to ensure integrity.


üß© Analyzing Image Dump

‚Ä¢ Open FTK Imager.
‚Ä¢ Click File > Add Evidence Item.
‚Ä¢ Select Evidence Type: choose Image File, then click Next.
‚Ä¢ Browse and Load the Image (e.g., .E01, .dd).
‚Ä¢ Expand the Folder Tree.
  ‚Üí View file system structure, deleted files, and metadata.
‚Ä¢ Preview Content.
  ‚Üí Use the lower pane to inspect text, hex, or file properties.
‚Ä¢ Export Evidence.
  ‚Üí Right-click any file or folder ‚Üí Export Files for reporting or further analysis.



-- Windows Forensic Artifacts --  

üñ•Ô∏è System Hives

Location: %SYSTEMROOT%\System32\Config

‚Ä¢ DEFAULT	HKEY_USERS\.DEFAULT
‚Ä¢ SAM	HKEY_LOCAL_MACHINE\SAM
‚Ä¢ SECURITY	HKEY_LOCAL_MACHINE\SECURITY
‚Ä¢ SOFTWARE	HKEY_LOCAL_MACHINE\SOFTWARE
‚Ä¢ SYSTEM	HKEY_LOCAL_MACHINE\SYSTEM

üë§ User Hives

Location: %USERPROFILE%

‚Ä¢ Hive File	Registry Mapping
‚Ä¢ NTUSER.DAT	HKEY_CURRENT_USER
‚Ä¢ USRCLASS.DAT	HKEY_CURRENT_USER\Software\Classes

File Download



-- Files --

Shell Bags
‚Ä¢ ShellBags are Windows Registry artifacts that store details about folders a user has accessed through Windows Explorer.
‚Ä¢ They record information such as view preferences (icons, list, details), window position and size, and sometimes the full path of the folder.
‚Ä¢ In digital forensics, ShellBags are highly valuable because they can reveal which directories a user has browsed ‚Äî even if the folders or files themselves have been deleted.

Current User (NTUSER.DAT)
HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\Bags
HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\BagMRU
HKEY_CURRENT_USER\Software\Microsoft\Windows\ShellNoRoam\Bags
HKEY_CURRENT_USER\Software\Microsoft\Windows\ShellNoRoam\BagMRU

All Users (USRCLASS.DAT)
HKEY_USERS\<SID>\Software\Microsoft\Windows\Shell\Bags
HKEY_USERS\<SID>\Software\Microsoft\Windows\Shell\BagMRU
HKEY_USERS\<SID>\Software\Microsoft\Windows\ShellNoRoam\Bags
HKEY_USERS\<SID>\Software\Microsoft\Windows\ShellNoRoam\BagMRU


LastVisitedPidMRU and OpenSavePidMRU
‚Ä¢ LastVisitedPidMRU and OpenSavePidMRU are related Windows artifacts stored in the user‚Äôs registry hives.
‚Ä¢ They are extremely useful in digital forensics because they track files and folders that a user has recently accessed, opened, or saved.
‚Ä¢ These entries can help investigators determine user activity, file interaction patterns, and potential data exfiltration behavior.

OpenSaveMRU / OpenSavePidMRU
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSaveMRU
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidMRU

LastVisitedMRU / LastVisitedPidMRU
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedMRU
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidMRU


RecentDocs
Stores a list of recently opened documents by file type and extension.

NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs


RunMRU
Stores commands and programs executed from the Windows Run dialog.

NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU


TypedPaths
Stores paths typed into the Windows Explorer address bar.

NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths


-- Program Execution --

UserAssist
Tracks GUI-based program executions (ROT13 encoded).

NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{GUID}\Count


Autostart Programs (Autoruns)
Lists programs configured to start automatically with Windows.

NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce
SOFTWARE\Microsoft\Windows\CurrentVersion\Run
SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run


Services
Contains information about the services that are installed on the system

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services


Scheduled Tasks
Stores programs or scripts configured to run at specific times or events.

C:\Windows\System32\Tasks\
HKLM\Software\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\Tree


https://github.com/Ahmed-AL-Maghraby/Windows-Registry-Analysis-Cheat-Sheet
https://cyber-ssct.com/SANS%20Digital%20Forensic%20Poster.pdf



-- LNK Files, Prefetch Files, and Jump Lists --  

Shortcut (LNK) Files
A .lnk shortcut is a small Windows file that points to another file, folder, or program and stores metadata (including the target/source path) so Windows can open it quickly.

Windows XP
C:%USERPROFILE%\Recent

Windows 7,8,10,11
C:%USERPROFILE%\AppData\Roaming\Microsoft\Windows\Recent\
C:%USERPROFILE%\AppData\Roaming\Microsoft\Office\Recent\


Prefetch files (PF)
A Prefetch (.pf) file is a Windows system file that records execution and resource usage data for applications to speed up loading and provide evidence that a program ran.

C:\Windows\Prefetch\


Jump Lists
A Jump List is a Windows artifact that tracks recently or frequently accessed files, folders, or tasks for specific applications, providing quick access through the taskbar or Start Menu and evidence of user activity.

Command Line
C:\Users\<username>\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations\
C:\Users\<username>\AppData\Roaming\Microsoft\Windows\Recent\CustomDestinations\

PowerShell
Get-ChildItem "$env:APPDATA\Microsoft\Windows\Recent\AutomaticDestinations" | Select-Object Name, Length, CreationTime, LastWriteTime

Get-ChildItem "$env:APPDATA\Microsoft\Windows\Recent\CustomDestinations" |
>> Select-Object Name, Length, CreationTime, LastWriteTime



-- Windows Forensic Artifact Triage -- 

When performing a live response or forensic acquisition, it‚Äôs often not necessary to capture everything at once.
Instead, focus on collecting a targeted set of high-value artifacts that reveal user activity, persistence mechanisms, logon behavior, and system usage.

Two common tools for this workflow are:
‚Ä¢ KAPE/gkape ‚Äì fast triage collection of predefined forensic artifacts.
‚Ä¢ FTK Imager ‚Äì for creating forensic images of memory, drives, or selected files.


1Ô∏è‚É£ Memory Capture (FTK Imager)

‚Ä¢ Open FTK Imager ‚Üí File ‚Üí Capture Memory.
‚Ä¢ Save the memory dump to an external drive.
  ‚Üí Optionally include pagefile.sys for swap analysis.
‚Ä¢ This allows later analysis of live processes, loaded drivers, network connections, and injected code.


2Ô∏è‚É£ Physical Drive / Targeted Capture (KAPE or gkape)

Using KAPE (kape.exe) or its GUI gkape, select targets for core forensic artifacts.

Recommended Targets:
‚Ä¢ !BasicCollection ‚Äì baseline Windows artifacts
‚Ä¢ !SANS_Triage ‚Äì SANS standard triage set
‚Ä¢ $LogFile ‚Äì NTFS transaction logs
‚Ä¢ $MFT ‚Äì Master File Table (records all filesystem entries)
‚Ä¢ RecycleBin ‚Äì deleted file evidence
‚Ä¢ RegistryHivesUsers ‚Äì per-user registry data (NTUSER.DAT, UsrClass.dat)
‚Ä¢ RegistryHivesSystem ‚Äì SYSTEM hive for OS configuration
‚Ä¢ RegistryHivesOther ‚Äì SAM, SECURITY, SOFTWARE hives
‚Ä¢ Amcache ‚Äì application execution evidence
‚Ä¢ LogFiles ‚Äì system logs, trace data
‚Ä¢ LNKFilesAndJumpLists ‚Äì recent file/document activity
‚Ä¢ Prefetch ‚Äì program execution evidence

‚úÖ These provide comprehensive coverage of file system, registry, user activity, and execution history.

.\kape.exe --tflush --target !SANS_Triage,RecycleBin,RegistryHives,$LogFile,$MFT,Amcache,LNKFilesAndJumpLists,LogFiles,Prefetch,RecycleBin_DataFiles,RecycleBin_InfoFiles,RegistryHivesSystem,RegistryHivesUser --gui


3Ô∏è‚É£ Targeted File/Folder Imaging (FTK Imager ‚Äì Custom Content)

FTK Imager allows imaging of specific artifacts when full disk imaging isn't possible.

1. In FTK Imager: File ‚Üí Create Disk Image.
2. Choose Custom Content Image.
3.Add the following artifact locations:

Artifacts to include:
‚Ä¢ $Recycle.Bin
‚Ä¢ Users (profiles, documents, browser data)
‚Ä¢ $LogFile, $MFT
‚Ä¢ pagefile.sys, swapfile.sys
‚Ä¢ Registry Hives:
  ‚Üí DEFAULT, SAM, SECURITY, SOFTWARE, SYSTEM
  ‚Üí Amcache.hve, RegBack (backup hives)
‚Ä¢ LogFiles, SRU (System Resource Usage Monitor)
‚Ä¢ NTUSER.DAT, UsrClass.dat
‚Ä¢ Event logs: *.evtx
‚Ä¢ Shortcuts and Execution Artifacts: *.lnk, *.pf, *.automaticDestinations-ms, *.customDestinations-ms

4. Create the image and verify integrity with hash values.


4Ô∏è‚É£ Why These Artifacts?

‚Ä¢ Memory dump: Captures volatile evidence (processes, malware, injected code).
‚Ä¢ $MFT, $LogFile, $UsnJrnl: Track filesystem changes and file existence.
‚Ä¢ Registry hives:	Show accounts, persistence, configuration.
‚Ä¢ Amcache / Shimcache:	Record executed programs.
‚Ä¢ Prefetch:	Reveal execution history, timestamps, run counts.
‚Ä¢ LNK & Jump Lists:	Indicate user document access.
‚Ä¢ Event logs:	Track logon/logoff, account creation, services.
‚Ä¢ Recycle Bin:	Show deleted files.
‚Ä¢ SRU (sru.db):	Record network and system resource usage.


5Ô∏è‚É£ Output & Next Steps

‚Ä¢ KAPE: outputs artifacts in a structured folder (optionally compressed).
‚Ä¢ FTK Imager: produces an E01 or RAW image of selected content.
‚Ä¢ Both outputs can be analyzed using forensic tools such as:
  ‚Üí Autopsy, X-Ways, Magnet AXIOM, or Eric Zimmerman‚Äôs tools.







