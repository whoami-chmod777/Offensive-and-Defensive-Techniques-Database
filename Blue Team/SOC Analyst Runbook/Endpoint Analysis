
--- Endpoint Analysis ---

‚Ä¢ Endpoint Security Controls 
‚Ä¢ Windows Network Analysis 
‚Ä¢ Windows Process Analysis  
‚Ä¢ Windows Core Processes
‚Ä¢ The Windows Registry  
‚Ä¢ Windows Autoruns
‚Ä¢ Windows Service Analysis  
‚Ä¢ Windows Scheduled Tasks  
‚Ä¢ Windows Event Logs  
‚Ä¢ Introduction to Sysmon  
‚Ä¢ Sysmon Events  
‚Ä¢ Linux Network Analysis  
‚Ä¢ Linux Process Analysis  
‚Ä¢ Linux Cron Jobs  
‚Ä¢ Introduction to LimaCharlie  
‚Ä¢ LimaCharlie Endpoint Detection and Response  
‚Ä¢ LimaCharlie Deploying Endpoint Agents  


-- Endpoint Security Controls --

Endpoint Security Controls:

‚Ä¢ Antivirus / Antimalware
  ‚Üí Scans files and activities
  ‚Üí Matches patterns and signatures
‚Ä¢ Endpoint Detection and Response (EDR)
  ‚Üí Real-time monitoring and response
  ‚Üí Agent-based deployment
  ‚Üí Monitors process, file, registry, and network activity
‚Ä¢ Extended Detection and Response (XDR)
  ‚Üí Integration of multiple security controls and telemetry
  ‚Üí Runbooks and automated response to routine threats
‚Ä¢ Data Loss Prevention (DLP)
  ‚Üí Protects sensitive data at rest, transit, and in processing
  ‚Üí Access controls, data masking, and prevention
‚Ä¢ User and Entity Behavior Analytics (UBA)
  ‚Üí Monitors user behavior patterns
  ‚Üí Detects deviations from historic and contextual baselines
  ‚Üí Identifies insider threats, account compromise, and data exfiltration
‚Ä¢ HIDS / HIPS
  ‚Üí HIDS: Host-based Intrusion Detection System
  ‚Üí HIPS: Host-based Intrusion Prevention System
‚Ä¢ Host-based Firewall
  ‚Üí Controls incoming and outgoing traffic on a host

Endpoint Security Monitoring

‚Ä¢ Process Execution
  ‚Üí Monitoring running processes
  ‚Üí Executable files, PIDs, and command-line arguments
  ‚Üí Parent-child process hierarchy
‚Ä¢ File System Changes
  ‚Üí Creation, modification, and deletion
  ‚Üí File Integrity Monitoring (FIM)
‚Ä¢ Network Connections
  ‚Üí Traffic and connections initiated from the endpoint
  ‚Üí Associated processes and executables
‚Ä¢ Registry Modifications
  ‚Üí Monitor registry keys and values
  ‚Üí Detect backdoors, persistence, and detection evasion



-- Windows Network Analysis --

üîß CMD Network Commands

net share ‚Üí View local shares
net share Exfil=C:\Users\admin\Downloads\exfil ‚Üí Create a share named ‚ÄúExfil‚Äù pointing to a folder (mount for sharing)
net use X: \127.0.0.1\Exfil ‚Üí Map network share Exfil to drive X:
net use ‚Üí Show mapped drives and active sessions
net view ‚Üí List computers and visible shares on the network
net view \127.0.0.1\ ‚Üí View shares on the local machine (by IP)
net view \HOSTNAME ‚Üí View shares on a specific host
net share \127.0.0.1\ ‚Üí Show local shares via IP path
net session ‚Üí Show active SMB sessions on this machine


üåê Network Statistics

netstat -anob ‚Üí Show all active connections with owning process/EXE
netstat -anob [ESTABLISHED] ‚Üí Show only established connections
netstat -e ‚Üí Display Ethernet statistics
netstat -nr ‚Üí Show routing table (numeric mode)
netstat -S ‚Üí Display per-protocol statistics
netstat -vb ‚Üí Show verbose info including the executable (admin required)


üì° IP / ARP / Routing

ipconfig /all ‚Üí Show detailed adapter configuration
arp -a ‚Üí View ARP cache (IP-to-MAC mappings)
route print ‚Üí Display system routing table
nbtstat -n ‚Üí Show local NetBIOS name table
nbtstat -A [IP] ‚Üí Display remote NetBIOS information


‚ö° PowerShell Network Commands

Get-NetAdapter ‚Üí View network interface card info
Get-NetIPAddress ‚Üí Display IPv4 and IPv6 configuration
Get-NetIPConfiguration ‚Üí Show full IP configuration
Get-NetRoute ‚Üí Display routing table

Get-NetTCPConnection ‚Üí Show active TCP connections (netstat equivalent)
Get-NetUDPEndpoint ‚Üí Display active UDP ports

Get-SmbShare ‚Üí View SMB shared folders
Get-SmbSession ‚Üí Show active SMB sessions
Get-SmbMapping ‚Üí Display mapped network drives
New-SmbShare -Name X -Path C:\ ‚Üí Create a new SMB share

Resolve-DnsName google.com ‚Üí Perform DNS lookup (like nslookup)
Test-Connection google.com ‚Üí Ping alternative using PowerShell
Test-NetConnection -Port 80 ‚Üí Test port connectivity

Get-NetFirewallRule ‚Üí View firewall rules
Get-NetFirewallProfile ‚Üí Check firewall status


üß† WMI-Based Network Enumeration

Get-WmiObject Win32_NetworkAdapterConfiguration ‚Üí Show NICs with IPs, MACs, and gateways
Get-WmiObject Win32_NetworkAdapter ‚Üí Display all network adapters
Get-WmiObject Win32_Share ‚Üí List all network shares
Get-WmiObject Win32_ServerConnection ‚Üí Show current network sessions
Get-WmiObject Win32_NetworkConnection ‚Üí View mapped network drives


üí° Other Useful Utilities

whoami /groups ‚Üí Show user group memberships
nltest /dclist:domain ‚Üí List domain controllers
net config workstation ‚Üí Show computer name and joined domain
net time \server ‚Üí Test time synchronization with a server
nslookup ‚Üí Perform DNS lookup
ping ‚Üí Test reachability and latency
tracert ‚Üí Trace network route to a host
pathping ‚Üí Combined ping + traceroute diagnostics


https://learn.microsoft.com/en-us/sysinternals/downloads/tcpview



-- Windows Process Analysis -- 

‚öôÔ∏è Process Management

tasklist ‚Üí Show all running processes
taskkill /PID 1234 /F ‚Üí Forcefully terminate a process by PID
tasklist /V ‚Üí Display detailed process info (memory, user, status)
tasklist /M ‚Üí Show which DLL modules each process has loaded

tasklist /M /FI "PID eq 2088" ‚Üí Show DLLs used by process with PID 2088
tasklist /FI "PID eq 2088" ‚Üí Show info only for PID 2088
tasklist /FI "IMAGENAME eq notmaleware.exe" ‚Üí Show info for a specific executable
tasklist /M /FI "PID eq 2088" ‚Üí List modules associated with the given process

Get-Process ‚Üí Show all running processes (like tasklist)
Stop-Process -Id 1234 -Force ‚Üí Forcefully terminate a process by PID (like taskkill /PID 1234 /F)
Get-Process | Sort-Object CPU -Descending ‚Üí Sort processes by CPU usage
Get-Process | Select-Object Name,Id,CPU,StartTime ‚Üí Display selected process details
Get-Process -Name notepad ‚Üí Show info for a specific process

Get-Process | Where-Object { $_.Id -eq 2088 } ‚Üí Filter process by PID
Get-Process | Where-Object { $_.Name -like "malware" } ‚Üí Search for suspicious process names


üåê Network Connections (Related to Processes)

netstat -ano ‚Üí Display all connections with owning process IDs
netstat -anob | findstr ESTABLISHED ‚Üí Show only established connections with process info

Get-NetTCPConnection ‚Üí Show active TCP connections (similar to netstat -ano)
Get-NetTCPConnection | Where-Object { $_.State -eq "Established" } ‚Üí Show established sessions only
Get-NetUDPEndpoint ‚Üí Display active UDP listeners
Get-NetTCPConnection | Select-Object LocalAddress,LocalPort,RemoteAddress,OwningProcess ‚Üí Show connection + PID mapping
Get-Process -Id (Get-NetTCPConnection | Where-Object { $_.RemotePort -eq 80 }).OwningProcess ‚Üí Identify which process owns a specific connection


üîß Windows Services and Components

sc query ‚Üí List all running and stopped services with current status

wmic service list brief ‚Üí Display a concise list of all services
wmic useraccount list full ‚Üí Show detailed information about user accounts

Get-Service ‚Üí List all Windows services and their status (like sc query)
Get-Service | Where-Object { $_.Status -eq 'Running' } ‚Üí Show only running services
Restart-Service -Name spooler ‚Üí Restart a service by name
Stop-Service -Name wuauserv -Force ‚Üí Stop Windows Update service
Set-Service -Name wuauserv -StartupType Disabled ‚Üí Disable a service from auto-starting
Get-WmiObject Win32_Service | Select Name,State,StartMode,PathName ‚Üí Display full details of each service


üß† Process Investigation (WMIC-Based)

wmic process list brief ‚Üí List processes with PID, command line, and parent info
wmic process where processid=2088 get Name,ParentProcessId,ProcessId ‚Üí Get process name and hierarchy for PID 2088
wmic process get Name,ParentProcessId,ProcessId | find "192" ‚Üí Search processes by number or string
wmic process where processid=2088 get CommandLine ‚Üí Show full command line for process 2088
wmic process where "name='cmd.exe'" get ProcessId,ParentProcessId,CommandLine ‚Üí Get process tree for specific executable

Get-WmiObject Win32_Process ‚Üí List all processes with detailed info
Get-WmiObject Win32_Process -Filter "ProcessId=2088" | Select Name,ParentProcessId,ProcessId ‚Üí Get parent-child hierarchy for PID 2088
Get-WmiObject Win32_Process | Where-Object { $_.CommandLine -like "192" } ‚Üí Search processes for IPs or commands
Get-WmiObject Win32_Process -Filter "Name='cmd.exe'" | Select ProcessId,ParentProcessId,CommandLine ‚Üí Inspect a specific process
Get-CimInstance Win32_Process | Select Name,ProcessId,ParentProcessId,CommandLine ‚Üí Newer alternative to WMIC


üß© System Startup and Persistence

wmic startup get Caption,Command,Location ‚Üí Show programs configured to run at startup
start msconfig ‚Üí Open System Configuration utility (startup/services control)
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run ‚Üí Check startup entries in registry

Get-CimInstance Win32_StartupCommand | Select Name,Command,Location,User ‚Üí Show startup items for all users
Get-ItemProperty 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Run' ‚Üí Check system-wide startup programs
Get-ItemProperty 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Run' ‚Üí Check per-user startup programs
Get-ScheduledTask | Where-Object { $_.State -eq 'Ready' } ‚Üí List all scheduled tasks that could persist malware
Get-Service | Where-Object { $_.StartType -eq 'Automatic' } ‚Üí Identify services that start automatically


üß± Common Persistence Registry Paths

HKLM\Software\Microsoft\Windows\CurrentVersion\Run ‚Üí Programs that auto-start for all users
HKCU\Software\Microsoft\Windows\CurrentVersion\Run ‚Üí Programs that auto-start for current user
HKLM\SYSTEM\CurrentControlSet\Services\ ‚Üí Services that start automatically with Windows
HKLM\Software\Microsoft\Active Setup\Installed Components ‚Üí Components that execute once per user login
HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell ‚Üí Custom shell entries that can persist malware


üí° Additional Useful PowerShell Tools

Get-WmiObject Win32_StartupCommand ‚Üí List startup commands with paths and locations
Get-EventLog -LogName Security -Newest 20 ‚Üí Review recent security events
Get-ScheduledTask ‚Üí View all scheduled tasks
Get-LocalUser ‚Üí List local user accounts
Get-LocalGroupMember Administrators ‚Üí List users in the Administrators group
Get-HotFix ‚Üí Show installed patches and updates


https://www.revshells.com/



-- Windows Core Processes -- 

Process Investigation
‚Ä¢ Parent Process: Check if hierarchy matches the expected chain (e.g., wininit ‚Üí services ‚Üí svchost).
‚Ä¢ Child Process: Look for suspicious spawns (e.g., svchost starting cmd.exe).
‚Ä¢ Command Line Arguments: Review parameters (e.g., svchost -k netsvcs).
‚Ä¢ Process Names: Watch for typos or fake copies (e.g., svch0st.exe).
‚Ä¢ User Account: Confirm process runs under the expected account.
‚Ä¢ Image Path: Validate that it matches the real system directory (not %TEMP% or AppData).


- Windows Core Process Hierarchy (Boot to User Session) -

System
‚Ä¢ Kernel-mode system thread (manages CPU, memory, and drivers)
‚Ä¢ Image Path: None (or C:\Windows\System32\ntoskrnl.exe)
‚Ä¢ PID: 4
‚Ä¢ Parent: None (System Idle Process)
‚Ä¢ Number of Instances: 1
‚Ä¢ User Account: Local System
‚Ä¢ Start Time: At boot

smss.exe (Session Manager Subsystem)
‚Ä¢ Manages user sessions and launches system processes
‚Ä¢ Spawns: wininit.exe, csrss.exe
‚Ä¢ Image Path: %SystemRoot%\System32\smss.exe
‚Ä¢ Parent: System (PID 4)
‚Ä¢ Number of Instances: 1 master, 1 child per session (child self-terminates)
‚Ä¢ User Account: Local System
‚Ä¢ Start Time: Within seconds of boot

csrss.exe (Client/Server Runtime Subsystem)
‚Ä¢ Handles console windows, Windows API DLLs, and GUI shutdown tasks
‚Ä¢ Image Path: %SystemRoot%\System32\csrss.exe
‚Ä¢ Parent: smss.exe (orphan process)
‚Ä¢ Number of Instances: Two or more
‚Ä¢ User Account: Local System
‚Ä¢ Instances: Two or more
‚Ä¢ Start Time: Within seconds of boot

wininit.exe (Windows Initialization)
‚Ä¢ Initializes system services (Session 0)
‚Ä¢ Spawns: services.exe, lsass.exe
‚Ä¢ Image Path: %SystemRoot%\System32\wininit.exe
‚Ä¢ Parent: smss.exe (orphan process)
‚Ä¢ Number of Instances: 1
‚Ä¢ User Account: Local System
‚Ä¢ Start Time: Within seconds of boot

services.exe (Service Control Manager)
‚Ä¢ Manages starting, stopping, and interaction of Windows services
‚Ä¢ Updates the LastKnownGood CurrentControlSet registry value for recovery.
‚Ä¢ Spawns: multiple svchost.exe instances
‚Ä¢ Image Path: %SystemRoot%\System32\services.exe
‚Ä¢ Parent: wininit.exe
‚Ä¢ User Account: Local System
‚Ä¢ Start Time: Within seconds of boot

svchost.exe (Service Host)
‚Ä¢ Hosts and manages Windows service DLLs
‚Ä¢ Runs with -k parameter to separate service groups
‚Ä¢ Image Path: %SystemRoot%\System32\svchost.exe
‚Ä¢ Parent: services.exe
‚Ä¢ Number of Instances: Many (typically 10+)
‚Ä¢ User Account: Local System / Network Service / Local Service / User
‚Ä¢ Start Time: Seconds after boot or when services start

lsass.exe (Local Security Authority Subsystem Service)
‚Ä¢ Authenticates users and enforces local security policies
‚Ä¢ Writes events to the Security Event Log
‚Ä¢ Image Path: %SystemRoot%\System32\lsass.exe
‚Ä¢ Parent: wininit.exe
‚Ä¢ Number of Instances: 1
‚Ä¢ User Account: Local System
‚Ä¢ Start Time: Within seconds of boot

winlogon.exe (Windows Logon)
‚Ä¢ Manages logon/logoff procedures
‚Ä¢ Loads user profiles (NTUSER.DAT)
‚Ä¢ Responds to Secure Attention Sequence (Ctrl+Alt+Del)
‚Ä¢ Image Path: %SystemRoot%\System32\winlogon.exe
‚Ä¢ Parent: smss.exe (orphan process)
‚Ä¢ Number of Instances: 1 or more
‚Ä¢ User Account: Local System
‚Ä¢ Start Time: Within seconds of boot (Session 1)

explorer.exe (Windows Explorer)
‚Ä¢ Provides desktop, taskbar, Start menu, and file management GUI
‚Ä¢ Image Path: %SystemRoot%\explorer.exe
‚Ä¢ Parent: userinit.exe (orphan process)
‚Ä¢ Number of Instances: 1 or more
‚Ä¢ User Account: Logged-in user
‚Ä¢ Start Time: When interactive session begins


üß© What is an "orphan process"

An "orphan process" is a process whose parent process has already terminated ‚Äî but the process itself is still running. The parent process is gone, but the child process continues running.

Example in Windows Boot

Let‚Äôs take userinit.exe ‚Üí explorer.exe as an example:
When a user logs in, winlogon.exe launches userinit.exe.
userinit.exe starts the user‚Äôs desktop environment by launching explorer.exe (the GUI).
Once explorer.exe is successfully running, userinit.exe exits (terminates).
explorer.exe keeps running ‚Äî but now it has no living parent process.
‚Üí So it becomes an orphan process.

Parent Process: userinit.exe (orphan process)

‚úÖ Legitimate orphan (normal) ‚Üí System boot or user logon ‚Äî processes like csrss.exe, wininit.exe, userinit.exe, or explorer.exe often become orphans naturally.
‚ö†Ô∏è Suspicious orphan (abnormal) ‚Üí Malware sometimes kills its parent process intentionally to hide its execution chain, leaving itself as an orphan ‚Äî which can make it harder to trace how it started.



-- The Windows Registry --  

The registry on any Windows system contains the following five root keys:

‚Ä¢ HKEY_CURRENT_USER
‚Ä¢ HKEY_USERS
‚Ä¢ HKEY_LOCAL_MACHINE
‚Ä¢ HKEY_CLASSES_ROOT
‚Ä¢ HKEY_CURRENT_CONFIG

HKEY_CURRENT_USER


HKEY_USERS


HKEY_LOCAL_MACHINE
‚Ä¢ Path: HKLM\
‚Ä¢ Purpose: Contains configuration data for the entire system, hardware, drivers, services, and installed software.
‚Ä¢ Important Subkeys
  ‚Üí HKLM\SYSTEM\CurrentControlSet\Services\ ‚Üí Malicious drivers, unauthorized services, Attackers may create or modify services for persistence

HKEY_CLASSES_ROOT


HKEY_CURRENT_CONFIG



















-- Windows Autoruns -- 
-- Windows Service Analysis --  
-- Windows Scheduled Tasks --  
-- Windows Event Logs --  
-- Introduction to Sysmon --  
-- Sysmon Events --  
-- Linux Network Analysis --  
-- Linux Process Analysis --  
-- Linux Cron Jobs --  
-- Introduction to LimaCharlie --  
-- LimaCharlie Endpoint Detection and Response --  
-- LimaCharlie Deploying Endpoint Agents -- 






