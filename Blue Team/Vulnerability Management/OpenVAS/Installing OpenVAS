
--- Installing OpenVAS ---

• Install OpenVAS repositories

The installation procedure for OpenVAS can vary based on how you decide to install. You can install from Kali/OpenVAS repos, install from source, or run from a docker container. 
The preferred method is to run it inside a docker container as we don't have to worry about a lot of the setup or errors that we may run into with other installation methods.

-- Install OpenVAS repositories --

➜ Docker

⇒ Install Docker

$ sudo apt update
$ sudo apt install docker.io -y
$ sudo systemctl enable docker --now
$ sudo systemctl status docker
$ sudo usermod -aG docker $USER
$ logout
$ docker --version

⇒ Install OpenVAS

$ docker pull mikesplain/openvas:9
$ docker run -d -p 443:443 --name openvas mikesplain/openvas

https://127.0.0.1

⇒ Error Message: Login failed. Waiting for OMP service to become available

It always means that the OpenVAS container hasn’t fully started internally.
With mikesplain/openvas, this almost always happens because the old OpenVAS-9 container takes a very long time to start or gets stuck.

$ docker logs -f openvas
$ docker ps
$ docker logs --tail 30 openvas
$ netstat -antp

#Testing redis status...
Redis not yet ready...
Redis not yet ready...
Redis not yet ready...
Redis not yet ready...
Redis not yet ready...
Redis ready.
Checking for empty volume
Restarting services
 * Restarting openvas-scanner openvassd
   ...done.
 * Restarting openvas-manager openvasmd
   ...done.
 * Restarting openvas-gsa gsad
   ...done.
Reloading NVTs

The container is currently loading the NVTs (Vulnerability Tests). During this time, logging in is NOT possible.
With this old OpenVAS 9 container, this step can take 10–60 minutes.

When new lines appear, such as:
• Updating NVT cache... done.
• Reloading NVTs complete.
• OpenVAS initialization complete.

→ Then the login will work immediately.

If the container is still stuck in the same place after 1 hour, tell me — then the old OpenVAS 9 container is frozen and we will switch to a working modern Docker image.



-- Installing GVM --

$ sudo apt update
$ sudo apt upgrade -y
$ sudo apt install gvm
$ sudo gvm-setup

> After the installation copy the Password for the admin account 

[*] User created with password '9c9c632d-4b92-4335-b984-101d21a51daf'.


$ sudo gvm-check-setup

It seems like your GVM-25.04.0 installation is OK.


$ netstat -antp   
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.1:9392          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:1883          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:80            0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:42989         127.0.0.1:46514         ESTABLISHED -                   
tcp        0      0 127.0.0.1:46514         127.0.0.1:42989         ESTABLISHED -                   
tcp6       0      0 ::1:5432                :::*                    LISTEN      -                   
tcp6       0      0 ::1:1883                :::*                    LISTEN      -                   
tcp6       0      0 ::1:1883                ::1:39535               ESTABLISHED -                   
tcp6       0      0 ::1:1883                ::1:36945               ESTABLISHED -                   
tcp6       0      0 ::1:36945               ::1:1883                ESTABLISHED -                   
tcp6       0      0 ::1:39535               ::1:1883                ESTABLISHED -                   
                                                                                                                                                       

$ sudo gvm-start
[i] GVM services are already running

https://127.0.0.1:9392

Username: admin
Password: 


➜ Administration: Feed Status
➜ Admin Settings: Change Password


-- Troubleshooting --

[1]

$ sudo gvm-setup

ERROR: The default PostgreSQL version (17) is not 18 that is required by libgvmd
ERROR: libgvmd needs PostgreSQL 18
ERROR: Use pg_upgradecluster to update your PostgreSQL cluster

$ sudo pg_upgradecluster 17 main
$ sudo pg_dropcluster 17 main
$ sudo gvm-setup

$ sudo pg_ctlcluster 17 main stop
$ sudo pg_ctlcluster 17 main start
$ sudo pg_ctlcluster 17 main status


[2]

$ sudo gvm-setup

ERROR: No PostgreSQL version uses the port 5432/TCP
ERROR: libgvmd needs PostgreSQL 17 to use the port 5432

$ sudo grep port /etc/postgresql/17/main/postgresql.conf
$ sudo nano /etc/postgresql/17/main/postgresql.conf
#port = 5432
port = 5432

$ sudo systemctl restart postgresql
$ sudo ss -tulpn | grep 5432

$ sudo gvm-setup
$ sudo ss -tulpn | grep 5432



-- Other Commands --

sudo -E -u _gvm -g _gvm gvmd --user=admin --new-password=<NEW_PASSWD>

$ sudo systemctl status gvmd
$ sudo systemctl stop gvmd
$ sudo systemctl start gvmd

$ sudo greenbone-feed-sync

$ sudo apt update
$ sudo apt upgrade -y
$ sudo apt upgrade -y | grep gvm

*
