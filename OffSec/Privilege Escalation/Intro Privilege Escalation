
Another very important step in penetration testing is the process of privilege escalation. Most systems are configured to be used by multiple users where it is good practice to apply the principle of least privilege (PoLP). The principle of least privilege essentially means that an object (user account, service, program etc.) should not be given more privileges than strictly required for its purpose. Practically this means that regular user accounts should not be able to install software or modify system configurations if they´re not system administrators and launch applications with as few privileges as possible. When we speak of system accounts we may refer to users as real people, with a privileged user account to perform their daily tasks, but also to service accounts. Service accounts typically have a separated functional task on the system which usually involves managing a service that is running on the system. A good example of this is the ‘www-data’ or ‘apache’ account that is used to manage web server processes and files on the system. While this account could be able to create files in the web root directory and underlying directories, it should not be able to do this outside the web root. When the principle of least privilege is applied, and a user or service account is compromised, the effects on the systems are limited by the privileges configured for the account. This means that if an attacker can get a shell on the system through a web service, the shell runs with the privileges of the web service account. To get full control of the system the attacker will look for ways to leverage vulnerabilities that allow for privilege escalation. Successful privilege escalation attacks allow the attacker to take full control of the system and access all resources and data available to it.

I will show here privilege escalation techniques for Windows and Linux. Privilege escalation is the process of increasing the level of privileges on a certain host to the highest privilege level possible. Usually, this means that when you have access to a host with a low privileged account, you are elevating privileges to system or domain admin on Windows or root on Linux. Generally, privilege escalation techniques target vulnerable operating systems, services, software and misconfigurations. Examples of situations that allow for privilege escalation are:

• Vulnerable software running under root privileges.
• Vulnerable kernels.
• Misconfigurations in service, system and security settings.
• Weak file and service permissions.
• Sensitive information stored in local files.
• Access to sensitive files such as the Windows SAM file.
• Installation scripts and data containing passwords.
• Scheduled tasks that execute scripts and programs.
• DLL Hijacking by overwriting poorly secured DLLs.
• Registry settings such as always elevated and automatically executed binaries.
• Malware to take sensitive user input.

As this list indicates, there are many ways how a system can be vulnerable to local privilege escalation. In general, it’s worth pointing out that successfully finding flaws that allow for privilege escalation, heavily relies on the information that is gathered from the target system. The more you know about the system and its environment, the better your chances are in successfully elevating your privilege level. This doesn’t just apply to your knowledge about a specific system and its variables but also to your knowledge about operating systems and how they work in general. Do you know how scheduled tasks work on Windows or cron jobs on Linux? Are you familiar with the directory structures on Linux systems? Are you able to work with the Windows registry? Did you answer such questions with ‘no’? Then it is recommended to spend some time on getting familiar with operating systems first, or at least research specific topics before attempting related techniques in the labs.
In the previous chapter we have learned how to compile exploits and exploit vulnerabilities. This information is a great basis and recommended read before proceeding with this chapter as you will need to compile a lot of local kernel privilege escalation exploits. New vulnerabilities in system software and services are discovered almost daily. New discoveries often reveal vulnerabilities that have been present in systems for decades leaving many systems vulnerable. Examples of such vulnerabilities are the Eternal Blue exploit targeting a wide range of Windows systems (from Windows XP to Windows Server 2016) and DirtyCow targeting 10 years of vulnerable Linux kernels. For this reason, it is important to test target hosts for critical privilege escalation exploits and keep your knowledge of these exploits up to date.
We will start the Linux and Windows privilege escalation chapters with some commands that can be used to enumerate the local system. The information retrieved from the system with these commands is generally a good first step in getting a better understanding of the system. The gathered information provides details about the OS and kernel version, what applications are installed, what services are running, network configurations, scheduled tasks, users accounts and many other details about the system. This information can then be used for finding flaws that allow for privilege escalation. In the Virtual Hacking Labs, you can practice most of the techniques that are covered in the courseware, including misconfigurations, vulnerable software and vulnerable kernels



