
--- Wireshark Analyzing Network Traffic --- 

â€¢ Detailing steps for Analyzing Network Traffic in Wireshark
â€¢ Step-by-step guide for analyzing network traffic using Wireshark


-- Detailing steps for Analyzing Network Traffic in Wireshark --

1. Set Time Step (UTC)
â€¢ Action: Adjust Wireshark to display timestamps in UTC.
â€¢ Why: Using UTC helps standardize timestamps, especially when correlating with logs from other systems (e.g., firewalls, SIEMs).

2. Check File Properties
â€¢ Action: Go to Statistics â†’ Capture File Properties.
â€¢ Why: Review file metadata, such as capture duration and file size, packet count, and file size to understand capture scope. Basic info on the capture file helps understand the scope and potential impact of captured events.

3. Analyze Conversations (IPv4)
â€¢ Action: Go to Statistics â†’ Conversations, select the IPv4 tab.
â€¢ Why: Identifying top talkers can reveal unusual or unauthorized devices communicating on the network.

4. Protocol Hierarchy
â€¢ Action: Go to Statistics â†’ Protocol Hierarchy.
â€¢ Why: Get an overview of protocol distribution; highlight abnormal or risky protocols (e.g., SMB, Telnet).
â€¢ Check the protocol hierarchy for an overview of protocols used. Analyzing the distribution of protocols can highlight abnormal use of high-risk protocols like HTTP or SMB.

5. Apply Display Filter (HTTP)
â€¢ Action: Enter http in the display filter for HTTP packets to focus on web traffic.
â€¢ Why: Focus analysis on web traffic to detect data leaks or suspicious requests.
â€¢ Focusing on HTTP traffic helps narrow down analysis to possible web-based threats or data exfiltration.

6. Follow HTTP Stream
â€¢ Action: Right-click an HTTP packet â†’ Follow â†’ HTTP Stream.
â€¢ Why: Reconstruct full web communication between client and server to identify credentials or exfiltrated data.
â€¢ This reveals the exact content exchanged, which may show compromised credentials or data leaks.

7. Follow TCP Stream
â€¢ Action: Right-click any TCP packet â†’ Follow â†’ TCP Stream.
â€¢ Why: Analyze full TCP sessions, useful for spotting C2 traffic or file transfers.
â€¢ Follow TCP streams for detailed TCP-based communication analysis.
â€¢ Following TCP streams can uncover details of suspicious connections, like C2 communication.

8. HTTP Statistics
â€¢ Action: Go to Statistics â†’ HTTP.
â€¢ Why: Review request types (e.g., GET, POST), hosts, and content types to detect anomalies.
â€¢ Review HTTP statistics for traffic volume, methods, and responses.
â€¢ Helps identify unusual activity, like a high volume of HTTP POST requests potentially indicating exfiltration.

9. Export Objects (HTTP)
â€¢ Action: Go to File â†’ Export Objects â†’ HTTP.
â€¢ Why: Extract transferred files (e.g., downloads, payloads) for malware or data leak analysis.
â€¢ Export HTTP objects (like files) sent over HTTP for deeper analysis.
â€¢ Extracting files allows further inspection for malware or sensitive data leakage.

10. Export Objects (SMB)
â€¢ Action: Go to File â†’ Export Objects â†’ SMB.
â€¢ Why: Retrieve files shared over SMB â€” common in lateral movement or worm propagation.
â€¢ Export SMB objects to examine files shared over the network.
â€¢ Useful for analyzing potential lateral movement or malware propagation over SMB shares.

11. Filter for ARP and Broadcast Traffic
â€¢ Filter: arp || eth.dst == ff:ff:ff:ff:ff:ff  
â€¢ Why: Detect ARP scanning, spoofing, or broadcast discovery attempts.
â€¢ Use arp and eth.dst == ff:ff:ff:ff:ff:ff to see ARP and broadcast packets.
â€¢ Broadcast traffic can indicate network discovery or scanning attempts.

12. Filter for ICMP Traffic
â€¢ Filter: icmp
â€¢ Why: View ping sweeps or error messages â€” often used in reconnaissance or diagnostics.
â€¢ Filter icmp to view ping and error messages.
â€¢ ICMP traffic can reveal network mapping attempts or misconfigurations.

13. IP Address Filter
â€¢ Filter: ip.addr == 10.0.0.1
â€¢ Why: Isolate traffic to/from a specific device for deeper inspection.
â€¢ Use ip.addr == 10.0.0.1 to filter traffic from a specific IP.
â€¢ Filtering by IP isolates traffic from a specific source or destination, making it easier to track specific devices.

14. SMTP Filter
â€¢ Filter: smtp
â€¢ Why: Review email traffic for signs of phishing, spam, or data exfiltration.
â€¢ Filter for smtp to review email-related traffic.
â€¢ Analyzing SMTP traffic can reveal unauthorized email exfiltration or phishing attempts.

15. Analyze Suspicious File (e.g., 86607.dat)
â€¢ Action: Export the file from HTTP/SMB stream or as a payload.
â€¢ Why: Investigate for malicious behavior or artifacts --> file 86607.dat
â€¢ Export and analyze file 86607.dat if flagged or suspicious.
â€¢ Exporting the file allows deeper inspection for malware or further analysis in external tools.

16. Calculate File Hash (SHA-256)
â€¢ Use sha256sum on 86607.dat to generate its SHA-256 hash for verification.
â€¢ A hash value helps uniquely identify the file, useful for malware detection and validation.
â€¢ Linux > sha256sum 86607.dat
â€¢ Windows > Get-FileHash -Algorithm SHA256 .\86607.dat

17. Submit to VirusTotal
â€¢ Action: Go to https://www.virustotal.com, submit the file or hash.
â€¢ Why: Scan against dozens of AV engines for known threats.
â€¢ Upload the SHA-256 hash or file to VirusTotal for threat intelligence analysis.
â€¢ VirusTotal scans against multiple antivirus engines to check if the file is flagged as malicious.

18. Submit to Malware Bazaar
â€¢ Action: Go to https://bazaar.abuse.ch, submit or search the file/hash.
â€¢ Why: Check for known malware families and IOCs.
â€¢ Upload or check file on Malware Bazaar for malware information.
â€¢ Malware Bazaar provides insights into known malware samples, which can assist in threat identification.

19. Analyze with CyberChef
â€¢ Action: Use https://gchq.github.io/CyberChef for decoding.
â€¢ Why: Decode, extract, or deobfuscate suspicious payloads (e.g., base64, XOR, hex).
â€¢ Use CyberChef for further decoding, deobfuscation, or extraction from suspicious data.
â€¢ CyberChef offers a variety of tools for transforming, decoding, or analyzing raw data and malicious code.


***************************************************************************************************************************

-- Step-by-step guide for analyzing network traffic using Wireshark --

Here's a step-by-step guide for analyzing network traffic using Wireshark, tailored for SOC analysts, incident responders, and network defenders. This guide balances technical precision with practical steps.

ğŸ” Step-by-Step: Analyzing Network Traffic in Wireshark

ğŸ§± 1. Load or Capture Network Traffic
â€¢ Open Wireshark.
â€¢ To capture live traffic:
  â†’ Select the correct network interface (e.g., Ethernet, Wi-Fi).
  â†’ Click Start.
â€¢ To load a PCAP:
  â†’ Go to File â†’ Open, and select a .pcap or .pcapng file.

ğŸ”¬ 2. Get an Overview of the Capture
Use the Statistics menu:
â€¢ Capture File Properties: Understand file size, duration, packets.
â€¢ Protocol Hierarchy: See what protocols are in use â€” unusual protocols may be suspicious.
â€¢ Endpoints & Conversations: Spot top talkers or new/suspicious IPs.
â€¢ IO Graphs: Visualize traffic spikes, drops, or patterns over time.

ğŸ“Œ 3. Identify and Filter Relevant Traffic
â€¢ Apply display filters:
  â†’ Filter by IP: ip.addr == x.x.x.x
  â†’ Only TCP traffic: tcp
  â†’ DNS queries only: dns && udp.port == 53
  â†’ HTTP requests: http.request
  â†’ Only marked packets:	frame.marked == 1

You can also color-code traffic or mark packets for later (Ctrl + M).

ğŸ“¡ 4. Inspect Individual Packets
â€¢ Click any packet to view the packet details pane.
â€¢ Expand protocol layers (e.g., Ethernet, IP, TCP, HTTP).
â€¢ Look for anomalies:
  â†’ Bad checksums
  â†’ TCP resets (RST)
  â†’ Suspicious domains or user agents
  â†’ Command-and-control indicators (strange URLs or base64 payloads)

ğŸ” 5. Follow Streams
â€¢ To reconstruct sessions:
â€¢ Right-click a packet â†’ Follow â†’ TCP Stream (or UDP/HTTP).
  â†’ This helps with:
  â†’ Viewing entire conversations (e.g., credentials in HTTP)
  â†’ Analyzing malware payloads or exfiltration streams
  â†’ Decoding base64 or inspecting ASCII commands

ğŸ“Š 6. Use Flow/Service/Stream Graphs (Advanced)
â€¢ Flow Graph:
  â†’ Visualizes communication order (good for attack kill chains).
â€¢ TCP Stream Graphs:
  â†’ Analyze retransmissions, throughput, round-trip times.
â€¢ Service Response Time:
  â†’ Measure DNS, HTTP, or SMB response times â€” abnormal latency can signal attack or tunneling.

ğŸ§  7. Analyze DNS and HTTP Behavior
â€¢ Statistics â†’ DNS:
  â†’ Look for high query rates, random subdomains (DGA), NXDOMAIN floods.
â€¢ Statistics â†’ HTTP:
  â†’ Find unusual methods (e.g., PUT, DELETE), strange user agents, long URIs (payloads?).

ğŸ“¦ 8. Extract Files or Payloads
â€¢ File â†’ Export Objects:
  â†’ Choose HTTP, SMB, etc.
  â†’ Export transferred executables, images, or other artifacts for malware analysis or evidence.

ğŸ“ 9. Document Findings
â€¢ Mark suspicious packets: frame.marked == 1
â€¢ Add comments: Right-click â†’ Packet Comment
â€¢ Export filtered packets:
  â†’ File â†’ Export Specified Packets (select only marked or filtered packets)
â€¢ Generate reports (e.g., protocol usage, conversations)

ğŸ” 10. Loop Back as Needed
â€¢ After spotting a lead (e.g., odd IP, large POST, encrypted DNS), return to steps 3â€“6 to pivot and drill deeper.

ğŸ§  Pro Tips for SOC Analysts
â€¢ Use external threat intel to correlate IPs, domains, or user agents.
â€¢ Combine Wireshark with Zeek logs or Suricata alerts when available.
â€¢ Practice with malicious PCAPs (e.g., from malware-traffic-analysis.net).




References
https://en.wikipedia.org/wiki/List_of_file_signatures
https://www.garykessler.net/library/file_sigs.html

https://www.virustotal.com
https://bazaar.abuse.ch
https://gchq.github.io/CyberChef
